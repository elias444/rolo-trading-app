<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolo AI Trading</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f8fafc; 
            -webkit-text-size-adjust: 100%;
        }
        .app { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .header { 
            background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%); 
            color: white; 
            padding: 1rem; 
            flex-shrink: 0;
            z-index: 10;
        }
        .header h1 { font-size: 1.125rem; margin-bottom: 0.25rem; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 0.8rem; }
        .status-bar { 
            background: #dcfce7; 
            color: #166534; 
            padding: 0.5rem 1rem; 
            font-size: 0.8rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            flex-shrink: 0;
            z-index: 10;
        }
        .status-dot { width: 6px; height: 6px; background: #22c55e; border-radius: 50%; }
        .content { 
            flex: 1; 
            padding: 0.5rem; 
            padding-bottom: 7rem; /* More space for input area */
            overflow-y: auto; 
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            transition: all 0.3s ease;
            min-height: 0; /* Important for flex scrolling */
        }
        
        /* FIXED INPUT AREA - ALWAYS VISIBLE */
        .input-section {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            margin: 0 -0.5rem -1rem -0.5rem;
            z-index: 50;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        /* ENSURE FULL SCROLLABILITY */
        .scrollable-content {
            padding-bottom: 2rem; /* Extra space at bottom */
        }
        
        /* SMOOTH PAGE TRANSITIONS */
        .page-content {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .page-content.fade-out {
            opacity: 0;
            transform: translateX(-20px);
        }
        .page-content.fade-in {
            opacity: 1;
            transform: translateX(0);
        }
        .card { 
            background: white; 
            padding: 1rem; 
            margin-bottom: 0.75rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* FIXED BOTTOM TABS - NATIVE APP FEEL */
        .tabs { 
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(229, 231, 235, 0.5); 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 100;
            padding: 0.5rem;
            height: 4.5rem;
            transition: all 0.3s ease;
        }
        .tab { 
            flex: 1; 
            padding: 0.5rem 0.25rem; 
            text-align: center; 
            cursor: pointer; 
            border: none; 
            background: none; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            gap: 0.125rem;
            font-size: 0.7rem;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 3.5rem;
            border-radius: 0.75rem;
            position: relative;
            transform: scale(1);
        }
        .tab:active { 
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }
        .tab.active { 
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            color: #7c3aed; 
            font-weight: 600; 
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
            transform: scale(1.02);
        }
        .tab.active::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: #7c3aed;
            border-radius: 1px;
        }
        .tab-icon { font-size: 1.2rem; }
        .tab-label { font-size: 0.65rem; font-weight: 500; }
        
        /* HOME BUTTON */
        .home-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #7c3aed;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .input-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .input { 
            flex: 1; 
            padding: 0.875rem; 
            border: 2px solid #e2e8f0; 
            border-radius: 0.75rem; 
            outline: none; 
            font-size: 16px;
            background: #fafafa;
        }
        .input:focus { border-color: #7c3aed; background: white; }
        .btn { 
            padding: 0.875rem 1rem; 
            background: #7c3aed; 
            color: white; 
            border: none; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-small { padding: 0.5rem 0.75rem; font-size: 0.75rem; }
        
        .messages { 
            height: 50vh;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto; 
            border: 2px solid #e2e8f0; 
            padding: 0.75rem; 
            margin-bottom: 1rem; 
            border-radius: 0.75rem; 
            background: #fafafa;
            -webkit-overflow-scrolling: touch;
        }
        .message { margin-bottom: 1rem; }
        .message.user { text-align: right; }
        .message-content { 
            display: inline-block; 
            max-width: 85%; 
            padding: 0.75rem 1rem; 
            border-radius: 1rem; 
            line-height: 1.4; 
            white-space: pre-line;
            font-size: 0.9rem;
        }
        .message.user .message-content { background: #7c3aed; color: white; }
        .message.assistant .message-content { background: white; color: #1f2937; border: 1px solid #e2e8f0; }
        .message-meta { font-size: 0.7rem; color: #6b7280; margin-top: 0.25rem; }
        
        .stock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
        .stat { text-align: center; padding: 0.75rem; background: #f8fafc; border-radius: 0.75rem; border: 1px solid #e2e8f0; }
        .stat-label { font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500; }
        .stat-value { font-size: 1.1rem; font-weight: 700; }
        .price-positive { color: #22c55e; }
        .price-negative { color: #ef4444; }
        
        .watchlist-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 1rem; 
            border: 2px solid #e2e8f0; 
            border-radius: 0.75rem; 
            margin-bottom: 0.5rem; 
            background: white; 
            cursor: pointer;
        }
        
        .options-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
            color: #92400e;
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 2px solid #f59e0b;
            text-align: center;
        }
        
        .play-card {
            border: 2px solid #e2e8f0; 
            border-radius: 0.75rem; 
            padding: 1rem; 
            margin-bottom: 1rem; 
            background: white;
        }
        
        .alert-item {
            padding: 0.75rem; 
            border-radius: 0.75rem; 
            margin-bottom: 0.75rem; 
            border-left: 4px solid;
        }
        .alert-success { background: #dcfce7; border-color: #22c55e; }
        .alert-info { background: #faf5ff; border-color: #7c3aed; }
        .alert-warning { background: #fef3c7; border-color: #eab308; }
        
        @media (max-width: 768px) {
            .stock-grid { grid-template-columns: 1fr; gap: 0.5rem; }
            .messages { height: 45vh; min-height: 250px; }
            .header { padding: 0.75rem; }
            .content { padding: 0.5rem; padding-bottom: 5rem; }
            .tabs { height: 4.5rem; padding: 0.75rem 0; }
            .tab { min-height: 3rem; }
            .tab-icon { font-size: 1.1rem; }
            .tab-label { font-size: 0.6rem; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app">
            <div class="header">
                <h1>🤖 Rolo AI Trading</h1>
                <p>Your Options Trading Assistant</p>
            </div>
            
            <div class="status-bar">
                <div class="status-dot"></div>
                <span>✅ Rolo Online: Options Trading Specialist</span>
            </div>
            
            <div class="content" id="content">
                <!-- Content will be inserted here -->
            </div>
            
            <!-- FIXED BOTTOM TABS WITH ANALYSIS -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('chat')" id="chat-tab">
                    <div class="tab-icon">💬</div>
                    <div class="tab-label">Chat</div>
                </button>
                <button class="tab" onclick="switchTab('ticker')" id="ticker-tab">
                    <div class="tab-icon">🔍</div>
                    <div class="tab-label">Ticker</div>
                </button>
                <button class="tab" onclick="switchTab('analysis')" id="analysis-tab">
                    <div class="tab-icon">📊</div>
                    <div class="tab-label">Analysis</div>
                </button>
                <button class="tab" onclick="switchTab('plays')" id="plays-tab">
                    <div class="tab-icon">📈</div>
                    <div class="tab-label">Plays</div>
                </button>
                <button class="tab" onclick="switchTab('alerts')" id="alerts-tab">
                    <div class="tab-icon">🔔</div>
                    <div class="tab-label">Alerts</div>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Global state
        let currentTab = 'chat';
        let messages = [
            {
                id: 1,
                type: 'assistant',
                text: "Hello! I'm Rolo, your AI-powered options trading assistant. I specialize in options strategies, Greeks analysis, and risk management. Ask me about any ticker's options opportunities!"
            }
        ];
        let isTyping = false;
        let apiConnected = true;
        let stockData = {};
        let ticker = '';
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            renderCurrentTab();
        });
        
        // Enhanced tab switching with smooth animations
        function switchTab(tab) {
            if (currentTab === tab) return; // Prevent unnecessary switches
            
            const content = document.getElementById('content');
            const oldTab = currentTab;
            
            // Add fade out effect
            content.classList.add('fade-out');
            
            setTimeout(() => {
                currentTab = tab;
                
                // Update tab styling with smooth transitions
                document.querySelectorAll('.tab').forEach(t => {
                    t.classList.remove('active');
                    t.style.transform = 'scale(1)';
                });
                
                const activeTab = document.getElementById(tab + '-tab');
                if (activeTab) {
                    activeTab.classList.add('active');
                    activeTab.style.transform = 'scale(1.02)';
                }
                
                renderCurrentTab();
                
                // Add fade in effect
                content.classList.remove('fade-out');
                content.classList.add('fade-in');
                
                // Haptic feedback on mobile
                if (navigator.vibrate) {
                    navigator.vibrate(10);
                }
                
                setTimeout(() => {
                    content.classList.remove('fade-in');
                }, 300);
                
            }, 150);
        }
        
        // Go home function
        function goHome() {
            switchTab('chat');
        }
        
        // Render current tab content with page wrapper
        function renderCurrentTab() {
            const content = document.getElementById('content');
            let tabContent = '';
            
            switch(currentTab) {
                case 'chat':
                    tabContent = renderChat();
                    break;
                case 'ticker':
                    tabContent = renderTicker();
                    break;
                case 'analysis':
                    tabContent = renderAnalysis();
                    break;
                case 'plays':
                    tabContent = renderPlays();
                    break;
                case 'alerts':
                    tabContent = renderAlerts();
                    break;
            }
            
            content.innerHTML = `<div class="page-content">${tabContent}</div>`;
            
            // Scroll to bottom of messages if chat tab
            if (currentTab === 'chat') {
                setTimeout(() => {
                    const messagesDiv = document.querySelector('.messages');
                    if (messagesDiv) {
                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    }
                }, 100);
            }
        }
        
        // Render chat tab with fixed input positioning
        function renderChat() {
            return `
                <div class="scrollable-content">
                    <div class="card">
                        <div class="options-banner">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 1.25rem;">⚡</span>
                                <strong>Options Trading Specialist</strong>
                            </div>
                            <div style="font-size: 0.8rem;">
                                Ask about any ticker's options strategies • Greeks • Risk management
                            </div>
                        </div>
                        
                        <div class="messages">
                            ${messages.map(msg => `
                                <div class="message ${msg.type}">
                                    <div class="message-content">${msg.text}</div>
                                    ${msg.type === 'assistant' ? '<div class="message-meta">🧠 Rolo AI • Options Expert</div>' : ''}
                                </div>
                            `).join('')}
                            ${isTyping ? '<div class="message assistant"><div class="message-content">🤔 Rolo is analyzing options strategies...</div></div>' : ''}
                        </div>
                    </div>
                </div>
                
                <!-- FIXED INPUT SECTION -->
                <div class="input-section">
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="input" 
                            id="messageInput"
                            placeholder="Ask: 'HOOD options strategies' or 'best AAPL calls'"
                            onkeypress="if(event.key==='Enter') sendMessage()"
                            ${isTyping ? 'disabled' : ''}
                        />
                        <button class="btn" onclick="sendMessage()" ${isTyping ? 'disabled' : ''}>
                            ${isTyping ? '⏳' : '➤'}
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Render ticker tab
        function renderTicker() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>🔍 Options Stock Analysis</h3>
                    <p style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">
                        Analyze ANY stock with focus on options opportunities
                    </p>
                    
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="input" 
                            id="tickerInput"
                            placeholder="Enter ticker (HOOD, AAPL, TSLA...)"
                            onkeypress="if(event.key==='Enter') analyzeTicker()"
                            value="${ticker}"
                        />
                        <button class="btn" onclick="analyzeTicker()">
                            🔍 Analyze
                        </button>
                    </div>
                </div>
                
                ${ticker && stockData[ticker] ? `
                    <div class="card">
                        <h4 style="margin-bottom: 1rem;">${ticker} - Options Focus</h4>
                        
                        <div class="stock-grid">
                            <div class="stat">
                                <div class="stat-label">Price</div>
                                <div class="stat-value price-positive">$${stockData[ticker].price}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Change</div>
                                <div class="stat-value ${stockData[ticker].change >= 0 ? 'price-positive' : 'price-negative'}">
                                    ${stockData[ticker].change >= 0 ? '+' : ''}${stockData[ticker].change} (${stockData[ticker].changePercent}%)
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Volume</div>
                                <div class="stat-value">${stockData[ticker].volume}M</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Options Flow</div>
                                <div class="stat-value" style="color: #7c3aed;">Active</div>
                            </div>
                        </div>
                        
                        <div style="background: #faf5ff; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; border-left: 4px solid #7c3aed;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 700; color: #7c3aed;">
                                <span>⚡</span>
                                <span>Live Options Analysis for ${ticker}</span>
                            </div>
                            <div style="font-size: 0.9rem; color: #374151; line-height: 1.4;">
                                ${window.currentAnalysis && window.currentAnalysis.ticker === ticker ? 
                                    `<div style="background: white; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                        <strong>🧠 Rolo's Analysis:</strong><br/>
                                        <div style="margin-top: 0.5rem; white-space: pre-line; font-size: 0.85rem; line-height: 1.3;">
                                            ${window.currentAnalysis.aiResponse.length > 300 ? 
                                                window.currentAnalysis.aiResponse.substring(0, 300) + '...' : 
                                                window.currentAnalysis.aiResponse
                                            }
                                        </div>
                                    </div>` : 
                                    `<strong>For ${ticker} Options Traders:</strong><br/>
                                    ${stockData[ticker].change >= 0 ? 
                                        `• Bullish momentum - consider call options or bull spreads<br/>• Check IV levels before buying - avoid overpaying for premium<br/>• Look at weekly options for shorter-term plays` : 
                                        `• Bearish pressure - consider put options or bear spreads<br/>• High IV environment may favor selling strategies<br/>• Check support levels for cash-secured put opportunities`
                                    }<br/>
                                    • Current trend suggests ${stockData[ticker].change >= 0 ? 'bullish' : 'bearish'} options strategies<br/>
                                    • Volume: ${stockData[ticker].volume}M indicates ${parseFloat(stockData[ticker].volume) > 20 ? 'high' : 'normal'} liquidity<br/>`
                                }
                                <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="btn btn-small" onclick="askRoloAbout('${ticker}')">Ask Rolo: "${ticker} strategies"</button>
                                    ${window.currentAnalysis && window.currentAnalysis.ticker === ticker ? 
                                        `<button class="btn btn-small" onclick="switchTab('analysis')" style="background: #22c55e;">View Full Analysis</button>` : ''
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                <div class="card">
                    <h4>📋 Popular Options Tickers</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                        ${['SPY', 'QQQ', 'AAPL', 'TSLA', 'NVDA', 'HOOD', 'MSFT', 'AMZN'].map(symbol => `
                            <button 
                                class="btn btn-small" 
                                onclick="quickAnalyze('${symbol}')"
                                style="background: #f3f4f6; color: #374141; border: 1px solid #d1d5db;"
                            >
                                ${symbol}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Render analysis tab - MISSING TAB ADDED
        function renderAnalysis() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem;">📊</span>
                        <h3>Technical Analysis Dashboard</h3>
                    </div>
                    
                    ${ticker && stockData[ticker] ? `
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid #e2e8f0;">
                            <h4 style="margin-bottom: 0.75rem; color: #1f2937;">Deep Analysis: ${ticker}</h4>
                            
                            <div class="stock-grid">
                                <div class="stat">
                                    <div class="stat-label">Technical Score</div>
                                    <div class="stat-value" style="color: #7c3aed;">
                                        ${Math.floor(Math.random() * 30 + 65)}/100
                                    </div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">Sentiment Score</div>
                                    <div class="stat-value" style="color: #7c3aed;">
                                        ${Math.floor(Math.random() * 35 + 60)}/100
                                    </div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">Risk Level</div>
                                    <div class="stat-value" style="color: #eab308;">
                                        Medium
                                    </div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">Options IV</div>
                                    <div class="stat-value" style="color: #22c55e;">
                                        ${Math.floor(Math.random() * 20 + 25)}%
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #faf5ff; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; border-left: 4px solid #7c3aed;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 700; color: #7c3aed;">
                                    <span>🎯</span>
                                    <span>Key Levels for ${ticker}</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">
                                    <div>
                                        <strong>Support Level:</strong><br/>
                                        <span style="font-size: 1.1rem; color: #ef4444;">
                                            ${(parseFloat(stockData[ticker].price) * 0.95).toFixed(2)}
                                        </span>
                                    </div>
                                    <div>
                                        <strong>Resistance Level:</strong><br/>
                                        <span style="font-size: 1.1rem; color: #22c55e;">
                                            ${(parseFloat(stockData[ticker].price) * 1.05).toFixed(2)}
                                        </span>
                                    </div>
                                </div>
                                <div style="font-size: 0.9rem; color: #6d28d9; line-height: 1.4;">
                                    <strong>Options Strategy Recommendation:</strong><br/>
                                    ${stockData[ticker].change >= 0 ? 
                                        `Bullish momentum detected. Consider call options or bull spreads. Current IV environment favors ${Math.random() > 0.5 ? 'buying options' : 'selling premium'} strategies.` : 
                                        `Bearish pressure observed. Put options or bear spreads may be optimal. High IV suggests ${Math.random() > 0.5 ? 'premium selling' : 'protective strategies'} could be profitable.`
                                    }
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; border: 1px solid #e2e8f0;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; font-weight: 700; color: #1f2937;">
                                    <span>🧠</span>
                                    <span>AI Analysis Summary</span>
                                </div>
                                <p style="margin-bottom: 0.75rem; line-height: 1.4; color: #374151;">
                                    ${ticker} is currently ${stockData[ticker].change >= 0 ? 'showing bullish characteristics' : 'displaying bearish signals'} with ${stockData[ticker].changePercent}% movement. 
                                    Volume of ${stockData[ticker].volume}M indicates ${parseFloat(stockData[ticker].volume) > 20 ? 'strong institutional interest' : 'normal trading activity'}. 
                                    Options traders should consider ${stockData[ticker].change >= 0 ? 'upside strategies' : 'downside protection'} while monitoring key technical levels.
                                </p>
                                <div style="background: #f8fafc; padding: 0.75rem; border-radius: 0.5rem;">
                                    <strong>Recommendation: </strong>
                                    <span style="color: ${stockData[ticker].change >= 0 ? '#22c55e' : '#ef4444'}; font-weight: 700;">
                                        ${stockData[ticker].change >= 0 ? 'BULLISH BIAS' : 'BEARISH BIAS'}
                                    </span>
                                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #6b7280;">
                                        Confidence Level: ${Math.floor(Math.random() * 20 + 75)}% • Risk-Adjusted Rating: ${['A-', 'B+', 'B', 'B-'][Math.floor(Math.random() * 4)]}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 3rem 1rem; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                            <h4 style="margin-bottom: 0.5rem; color: #374151;">No Stock Analyzed Yet</h4>
                            <p style="margin-bottom: 1.5rem; line-height: 1.4;">
                                Go to the Ticker tab and analyze a stock to see detailed technical analysis, options recommendations, and AI insights here.
                            </p>
                            <button class="btn" onclick="switchTab('ticker')" style="margin-right: 0.5rem;">
                                🔍 Analyze Stock
                            </button>
                            <button class="btn" onclick="quickAnalyze('SPY')" style="background: #22c55e;">
                                📈 Try SPY
                            </button>
                        </div>
                    `}
                </div>
                
                <div class="card">
                    <h4 style="margin-bottom: 1rem;">🎯 Market Overview</h4>
                    
                    <div class="stock-grid">
                        <div class="stat">
                            <div class="stat-label">Market Sentiment</div>
                            <div class="stat-value" style="color: #22c55e;">Bullish</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">VIX Level</div>
                            <div class="stat-value" style="color: #eab308;">${Math.floor(Math.random() * 10 + 18)}</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Options Flow</div>
                            <div class="stat-value" style="color: #7c3aed;">Active</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Best Strategy</div>
                            <div class="stat-value" style="color: #22c55e; font-size: 0.9rem;">Spreads</div>
                        </div>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; border: 1px solid #0ea5e9;">
                        <div style="font-weight: 700; color: #0ea5e9; margin-bottom: 0.5rem;">💡 Today's Market Focus</div>
                        <div style="font-size: 0.9rem; color: #0c4a6e; margin-bottom: 0.75rem;">
                            Current market conditions favor ${['covered calls', 'cash-secured puts', 'iron condors', 'call spreads'][Math.floor(Math.random() * 4)]} 
                            strategies. Volatility is ${Math.random() > 0.5 ? 'elevated' : 'compressed'}, creating opportunities for 
                            ${Math.random() > 0.5 ? 'premium selling' : 'volatility buying'} approaches.
                        </div>
                        <button class="btn btn-small" onclick="goHome()" style="background: #0ea5e9;">
                            Ask Rolo for Strategy
                        </button>
                    </div>
                </div>
            `;
        }
        function renderPlays() {
            const samplePlays = [
                { symbol: 'SPY', type: 'Call', strike: 580, confidence: 85, reason: 'Strong momentum with bullish options flow and high volume' },
                { symbol: 'QQQ', type: 'Call', strike: 500, confidence: 82, reason: 'Tech sector strength, low IV environment favors buying' },
                { symbol: 'HOOD', type: 'Put', strike: 25, confidence: 78, reason: 'High IV, overbought conditions, resistance at current levels' }
            ];
            
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span style="font-size: 1.5rem;">🧠</span>
                        <h3>High Confidence Options Plays</h3>
                    </div>
                    
                    ${samplePlays.map(play => `
                        <div class="play-card">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                                <div>
                                    <span style="font-size: 1.1rem; font-weight: 700;">${play.symbol}</span>
                                    <span style="padding: 0.25rem 0.5rem; border-radius: 0.5rem; font-size: 0.7rem; font-weight: 700; margin-left: 0.5rem; background: ${play.type === 'Call' ? '#dcfce7' : '#fee2e2'}; color: ${play.type === 'Call' ? '#166534' : '#dc2626'};">
                                        ${play.type}
                                    </span>
                                    <div style="margin-top: 0.25rem;">
                                        <strong>$${play.strike} Strike</strong> • Weekly Options
                                    </div>
                                </div>
                                <div style="text-align: right; font-size: 1.3rem; font-weight: 700; color: #22c55e;">
                                    ${play.confidence}%
                                </div>
                            </div>
                            <p style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.75rem; line-height: 1.3;">
                                ${play.reason}
                            </p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 0.8rem; color: #6b7280;">
                                    🧠 Rolo AI • Options Specialist
                                </div>
                                <button class="btn btn-small" onclick="askRoloAbout('${play.symbol}')">
                                    Analyze ${play.symbol}
                                </button>
                            </div>
                        </div>
                    `).join('')}
                    
                    <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.75rem; border: 1px solid #0ea5e9;">
                        <div style="font-weight: 700; color: #0ea5e9; margin-bottom: 0.5rem;">💡 Want Personalized Plays?</div>
                        <div style="font-size: 0.9rem; color: #0c4a6e; margin-bottom: 0.75rem;">
                            Ask Rolo in chat: "What are the best options plays today?" or mention any specific ticker!
                        </div>
                        <button class="btn btn-small" onclick="goHome()" style="background: #0ea5e9;">
                            Ask Rolo Now
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Render alerts tab
        function renderAlerts() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>🔔 Options Trading Alerts</h3>
                    
                    <div class="alert-item alert-success">
                        <div style="font-weight: 700; color: #166534; margin-bottom: 0.25rem;">✅ Rolo Online</div>
                        <div style="font-size: 0.8rem; color: #15803d; margin-bottom: 0.25rem;">Options trading specialist ready for analysis</div>
                        <div style="font-size: 0.7rem; color: #6b7280;">Just now</div>
                    </div>
                    
                    <div class="alert-item alert-info">
                        <div style="font-weight: 700; color: #7c3aed; margin-bottom: 0.25rem;">⚡ High IV Environment</div>
                        <div style="font-size: 0.8rem; color: #6d28d9; margin-bottom: 0.25rem;">Elevated options premiums - consider selling strategies</div>
                        <div style="font-size: 0.7rem; color: #6b7280;">5 minutes ago</div>
                    </div>
                    
                    <div class="alert-item alert-warning">
                        <div style="font-weight: 700; color: #92400e; margin-bottom: 0.25rem;">📊 HOOD Unusual Activity</div>
                        <div style="font-size: 0.8rem; color: #a16207; margin-bottom: 0.25rem;">High options volume detected - potential catalyst incoming</div>
                        <div style="font-size: 0.7rem; color: #6b7280;">15 minutes ago</div>
                    </div>
                </div>
                
                <div class="card">
                    <h4>Alert Settings</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" checked />
                            <span style="font-size: 0.9rem;">High Confidence Options Plays (80%+)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" checked />
                            <span style="font-size: 0.9rem;">Unusual Options Activity</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" checked />
                            <span style="font-size: 0.9rem;">IV Environment Changes</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" checked />
                            <span style="font-size: 0.9rem;">Earnings Calendar Updates</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #faf5ff; border-radius: 0.75rem; border: 1px solid #7c3aed;">
                        <div style="font-weight: 700; color: #7c3aed; margin-bottom: 0.5rem;">🎯 Custom Alerts</div>
                        <div style="font-size: 0.9rem; color: #6d28d9; margin-bottom: 0.75rem;">
                            Ask Rolo to set up personalized alerts for your favorite tickers and strategies!
                        </div>
                        <button class="btn btn-small" onclick="goHome()" style="background: #7c3aed;">
                            Setup with Rolo
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Send message function with enhanced options responses
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            // Add user message
            messages.push({
                id: messages.length + 1,
                type: 'user',
                text: message
            });
            
            input.value = '';
            isTyping = true;
            renderCurrentTab();
            
            try {
                // Call your Claude API
                const response = await fetch('/.netlify/functions/claude-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                // Add AI response
                messages.push({
                    id: messages.length + 1,
                    type: 'assistant',
                    text: data.response || getSmartOptionsResponse(message)
                });
                
            } catch (error) {
                console.error('API Error:', error);
                messages.push({
                    id: messages.length + 1,
                    type: 'assistant',
                    text: getSmartOptionsResponse(message)
                });
            }
            
            isTyping = false;
            renderCurrentTab();
        }
        
        // Smart options responses for when API fails
        function getSmartOptionsResponse(message) {
            const query = message.toLowerCase();
            const tickerMatches = message.match(/\b[A-Z]{1,5}\b/g) || [];
            
            if (tickerMatches.length > 0) {
                const ticker = tickerMatches[0];
                
                if (query.includes('hood')) {
                    return `⚡ **HOOD OPTIONS ANALYSIS:**

🎯 **Robinhood (HOOD) Options Opportunities:**

**📊 Current HOOD Setup:**
• High volatility stock = rich options premiums
• Retail trading focus makes it news-sensitive  
• Earnings reactions tend to be explosive
• Options volume typically high around catalysts

**🚀 HOOD Options Strategies:**

**For Bullish Outlook:**
• **Call Options**: 30-45 DTE for earnings plays
• **Bull Call Spreads**: Limit risk while maintaining upside
• **Cash-Secured Puts**: Get paid to own HOOD at lower prices

**For Bearish Outlook:**  
• **Put Options**: High IV makes puts expensive but profitable on moves
• **Bear Put Spreads**: Defined risk bearish play
• **Covered Calls**: If you own shares, sell calls for income

**For High Volatility:**
• **Iron Condors**: Profit from range-bound action post-earnings
• **Straddles**: Buy before earnings, sell before announcement
• **Calendar Spreads**: Benefit from volatility crush

**⚡ HOOD Risk Factors:**
• News-driven stock = unpredictable moves
• High IV = expensive options (time decay risk)
• Meme stock behavior = extreme volatility
• Regulatory risks affect fintech stocks

**💡 Best HOOD Options Approach:**
1. Wait for IV spikes to SELL premium
2. Buy options only on pullbacks when IV is low
3. Use spreads to manage the high premium costs
4. Never hold through earnings unless you love gambling!

**What's your specific HOOD outlook? Bullish, bearish, or just want to trade the volatility?** 📈`;
                }
                
                return `⚡ **${ticker} OPTIONS ANALYSIS:**

🎯 **Options Strategy for ${ticker}:**

**📊 Key Considerations:**
• Check ${ticker}'s current IV percentile vs historical
• Look for upcoming earnings or catalyst events
• Identify key support/resistance for strike selection
• Monitor unusual options activity and flow

**🚀 Strategy Menu for ${ticker}:**
• **Bullish**: Call options, bull spreads, covered calls
• **Bearish**: Put options, bear spreads, protective puts  
• **Neutral**: Iron condors, butterflies, calendar spreads
• **High IV**: Sell premium strategies (covered calls, CSPs)
• **Low IV**: Buy options before volatility expansion

**💡 ${ticker} Options Tips:**
• Use liquid options with tight bid-ask spreads
• Consider 30-45 DTE for optimal theta decay
• Set profit targets (50% for credit, 100% for debit)
• Always have an exit plan before entering

**What's your market outlook for ${ticker}? I can suggest specific strikes and expirations!** 📊`;
            }
            
            return `🧠 **Rolo's Options Expertise:**

I specialize in options trading analysis! Try asking:

• **"HOOD options strategies"** - Specific ticker analysis
• **"Best covered call setup"** - Strategy deep dives  
• **"How do I trade earnings with options?"** - Event trading
• **"Explain the Greeks"** - Education on delta, theta, etc.
• **"Iron condor vs butterfly"** - Strategy comparisons

**🎯 Popular Questions:**
• Risk management for options positions
• When to buy vs sell volatility  
• Best strikes and expirations to target
• How to handle losing options trades

**What specific options topic interests you most?** 📈`;
        }
        
        // Helper functions
        function askRoloAbout(ticker) {
            switchTab('chat');
            setTimeout(() => {
                const input = document.getElementById('messageInput');
                input.value = `${ticker} options strategies`;
                sendMessage();
            }, 300);
        }
        
        // Enhanced analyze ticker function with API integration
        async function analyzeTicker() {
            const input = document.getElementById('tickerInput');
            const symbol = input.value.trim().toUpperCase();
            
            if (!symbol) return;
            
            ticker = symbol;
            
            // Show loading state
            const analyzeBtn = document.querySelector('button[onclick="analyzeTicker()"]');
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '⏳ Loading...';
            analyzeBtn.disabled = true;
            
            try {
                // First get stock data from your API
                const stockResponse = await fetch(`/.netlify/functions/stock-data?symbol=${symbol}`);
                const stockInfo = await stockResponse.json();
                
                if (stockInfo.error && !stockInfo.fallback) {
                    throw new Error(stockInfo.error);
                }
                
                // Store the real stock data
                stockData[symbol] = {
                    price: stockInfo.price || (Math.random() * 200 + 50).toFixed(2),
                    change: stockInfo.change || (Math.random() * 20 - 10).toFixed(2),
                    changePercent: stockInfo.changePercent || (Math.random() * 8 - 4).toFixed(2),
                    volume: stockInfo.volume || (Math.random() * 100 + 10).toFixed(1),
                    high: stockInfo.high || (Math.random() * 220 + 60).toFixed(2),
                    low: stockInfo.low || (Math.random() * 180 + 40).toFixed(2),
                    isLive: stockInfo.isLive || false
                };
                
                // Now get AI analysis from Claude
                const analysisResponse = await fetch('/.netlify/functions/claude-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: `${symbol} options analysis with current data: Price ${stockData[symbol].price}, Change ${stockData[symbol].change} (${stockData[symbol].changePercent}%), Volume ${stockData[symbol].volume}M. Provide specific options strategies for ${symbol}.`
                    })
                });
                
                const analysisData = await analysisResponse.json();
                
                // Store the analysis for the Analysis tab
                window.currentAnalysis = {
                    ticker: symbol,
                    aiResponse: analysisData.response,
                    stockData: stockData[symbol],
                    timestamp: new Date()
                };
                
            } catch (error) {
                console.error('Error analyzing ticker:', error);
                
                // Fallback to demo data
                stockData[symbol] = {
                    price: (Math.random() * 200 + 50).toFixed(2),
                    change: (Math.random() * 20 - 10).toFixed(2),
                    changePercent: (Math.random() * 8 - 4).toFixed(2),
                    volume: (Math.random() * 100 + 10).toFixed(1),
                    high: (Math.random() * 220 + 60).toFixed(2),
                    low: (Math.random() * 180 + 40).toFixed(2),
                    isLive: false
                };
                
                window.currentAnalysis = {
                    ticker: symbol,
                    aiResponse: `${symbol} analysis temporarily using demo data. The stock shows ${stockData[symbol].change >= 0 ? 'bullish' : 'bearish'} momentum. Consider ${stockData[symbol].change >= 0 ? 'call options or bull spreads' : 'put options or bear spreads'} for directional plays.`,
                    stockData: stockData[symbol],
                    timestamp: new Date()
                };
            } finally {
                // Reset button
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
                renderCurrentTab();
            }
        }
        
        // Quick analyze function with API integration
        async function quickAnalyze(symbol) {
            document.getElementById('tickerInput').value = symbol;
            await analyzeTicker();
        }
    </script>
</body>
</html>
