<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rolo AI - Professional Trading Assistant</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rolo AI">
    <meta name="theme-color" content="#007aff">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Rolo%20AI%20Trading%22,%22short_name%22:%22Rolo%22,%22display%22:%22standalone%22,%22orientation%22:%22portrait%22,%22theme_color%22:%22%23007aff%22,%22background_color%22:%22%23000000%22,%22start_url%22:%22/%22,%22scope%22:%22/%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23007aff'/><text x='50' y='55' font-family='Arial' font-size='50' fill='white' text-anchor='middle' dominant-baseline='middle'>R</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <style>
        /* iOS Design System Variables */
        :root {
            --ios-blue: #007aff;
            --ios-blue-light: #5ac8fa;
            --ios-gray: #8e8e93;
            --ios-gray-light: #f2f2f7;
            --ios-gray-dark: #1c1c1e;
            --ios-green: #30d158;
            --ios-red: #ff3b30;
            --ios-orange: #ff9500;
            --ios-system-background: #ffffff;
            --ios-secondary-background: #f2f2f7;
            --ios-card-background: rgba(255, 255, 255, 0.95);
            --ios-border-color: rgba(60, 60, 67, 0.12);
            --ios-text-primary: #000000;
            --ios-text-secondary: #3c3c43;
            --ios-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --ios-shadow-card: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --ios-system-background: #000000;
                --ios-secondary-background: #1c1c1e;
                --ios-card-background: rgba(28, 28, 30, 0.95);
                --ios-border-color: rgba(84, 84, 88, 0.48);
                --ios-text-primary: #ffffff;
                --ios-text-secondary: #ebebf5;
                --ios-gray-light: #2c2c2e;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--ios-system-background);
            color: var(--ios-text-primary);
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            position: fixed;
            width: 100%;
            height: 100%;
            font-size: 17px;
            line-height: 1.47;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: var(--ios-system-background);
        }

        /* iOS-style Header */
        .header {
            background: var(--ios-card-background);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: env(safe-area-inset-top, 44px) 20px 16px;
            text-align: center;
            border-bottom: 0.5px solid var(--ios-border-color);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 700;
            color: var(--ios-blue);
            margin-bottom: 2px;
            letter-spacing: -0.4px;
        }

        .header p {
            font-size: 13px;
            color: var(--ios-text-secondary);
            font-weight: 400;
        }

        .status-indicator {
            position: absolute;
            top: env(safe-area-inset-top, 50px);
            right: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 500;
            color: var(--ios-text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--ios-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        /* iOS-style Content Area */
        .content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: var(--ios-secondary-background);
        }

        .tab-pane {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 100px;
        }

        .tab-pane.active {
            opacity: 1;
            transform: translateX(0);
        }

        /* iOS-style Chat */
        .chat-container {
            padding: 16px;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--ios-system-background);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 16px;
            padding-right: 4px;
        }

        .chat-message {
            background: var(--ios-card-background);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 0.5px solid var(--ios-border-color);
            box-shadow: var(--ios-shadow);
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-message.user {
            background: var(--ios-blue);
            color: white;
            margin-left: 20%;
            border: none;
        }

        .chat-message.ai {
            background: var(--ios-card-background);
            margin-right: 20%;
        }

        .message-text {
            font-size: 16px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        /* iOS-style Chat Input */
        .chat-input-container {
            background: var(--ios-card-background);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 0.5px solid var(--ios-border-color);
            box-shadow: var(--ios-shadow);
            margin-top: auto;
        }

        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--ios-text-primary);
            font-size: 16px;
            padding: 8px 0;
            font-family: inherit;
            min-height: 20px;
            resize: none;
        }

        .chat-input::placeholder {
            color: var(--ios-text-secondary);
        }

        .send-btn {
            background: var(--ios-blue);
            border: none;
            border-radius: 16px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .send-btn:active {
            transform: scale(0.95);
            background: var(--ios-blue-light);
        }

        /* iOS-style Cards */
        .ios-card {
            background: var(--ios-card-background);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 0.5px solid var(--ios-border-color);
            box-shadow: var(--ios-shadow-card);
            margin: 16px;
            padding: 16px;
            transition: all 0.2s ease;
        }

        .ios-card:active {
            transform: scale(0.98);
            box-shadow: var(--ios-shadow);
        }

        .card-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--ios-text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.4px;
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--ios-text-secondary);
            font-weight: 400;
            margin-bottom: 12px;
        }

        /* iOS-style Input Fields */
        .ios-input {
            background: var(--ios-card-background);
            border: 0.5px solid var(--ios-border-color);
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 16px;
            color: var(--ios-text-primary);
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 12px;
        }

        .ios-input:focus {
            border-color: var(--ios-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .ios-input::placeholder {
            color: var(--ios-text-secondary);
        }

        /* iOS-style Buttons */
        .ios-btn {
            background: var(--ios-blue);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 17px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-family: inherit;
            letter-spacing: -0.4px;
        }

        .ios-btn:active {
            transform: scale(0.96);
            background: var(--ios-blue-light);
        }

        .ios-btn.secondary {
            background: var(--ios-gray-light);
            color: var(--ios-text-primary);
        }

        .ios-btn.secondary:active {
            background: var(--ios-gray);
        }

        /* Stock Display */
        .stock-display {
            background: var(--ios-card-background);
            border-radius: 12px;
            border: 0.5px solid var(--ios-border-color);
            box-shadow: var(--ios-shadow-card);
            margin: 16px;
            padding: 20px;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stock-symbol {
            font-size: 28px;
            font-weight: 700;
            color: var(--ios-text-primary);
            letter-spacing: -0.6px;
        }

        .stock-price {
            font-size: 24px;
            font-weight: 600;
            color: var(--ios-green);
            text-align: right;
            letter-spacing: -0.4px;
        }

        .stock-change {
            font-size: 14px;
            font-weight: 500;
            text-align: right;
            margin-top: 2px;
        }

        .stock-change.positive { color: var(--ios-green); }
        .stock-change.negative { color: var(--ios-red); }

        .stock-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .detail-item {
            text-align: center;
            padding: 12px;
            background: var(--ios-secondary-background);
            border-radius: 8px;
        }

        .detail-label {
            font-size: 11px;
            color: var(--ios-text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--ios-text-primary);
        }

        /* iOS-style Grid */
        .ios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 16px;
        }

        .grid-button {
            background: var(--ios-card-background);
            border: 0.5px solid var(--ios-border-color);
            border-radius: 12px;
            padding: 16px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: var(--ios-shadow);
        }

        .grid-button:active {
            transform: scale(0.95);
            background: var(--ios-blue);
            color: white;
        }

        .grid-button-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--ios-text-primary);
            letter-spacing: -0.2px;
        }

        /* iOS-style Tab Bar */
        .ios-tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--ios-card-background);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid var(--ios-border-color);
            padding: 8px 0 env(safe-area-inset-bottom, 8px);
            z-index: 1000;
        }

        .tab-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 8px;
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
            min-width: 44px;
            position: relative;
        }

        .tab-item:active {
            transform: scale(0.95);
        }

        .tab-item.active {
            color: var(--ios-blue);
        }

        .tab-icon {
            font-size: 24px;
            margin-bottom: 2px;
            transition: all 0.2s ease;
        }

        .tab-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--ios-text-secondary);
            letter-spacing: 0.1px;
        }

        .tab-item.active .tab-label {
            color: var(--ios-blue);
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            color: var(--ios-text-secondary);
            padding: 40px 20px;
            font-size: 16px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--ios-border-color);
            border-top: 2px solid var(--ios-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 59, 48, 0.1);
            border: 0.5px solid var(--ios-red);
            color: var(--ios-red);
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .ios-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stock-details {
                grid-template-columns: 1fr;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .loading-spinner {
                border-color: var(--ios-border-color);
                border-top-color: var(--ios-blue);
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Hide scrollbars but keep functionality */
        ::-webkit-scrollbar {
            display: none;
        }

        .tab-pane {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- iOS-style Header -->
        <div class="header">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Live</span>
            </div>
            <h1>Rolo AI</h1>
            <p>Professional Trading Assistant</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Chat Tab (Default) -->
            <div class="tab-pane active" id="chat">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message ai">
                            <div class="message-text">
                                üëã Hey there! I'm Rolo AI, your intelligent trading assistant. I analyze markets, explain strategies, and help you make smarter trading decisions.
                                <br><br>
                                <strong>Try asking me:</strong>
                                <br>‚Ä¢ "What's your take on AAPL for tomorrow?"
                                <br>‚Ä¢ "Analyze TSLA with technical indicators"
                                <br>‚Ä¢ "What are some good plays this week?"
                                <br>‚Ä¢ "Explain market sentiment today"
                                <br><br>
                                I use real-time data and advanced analysis to give you professional insights! üìä
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="chatInput" placeholder="Ask me about stocks, markets, or trading..." rows="1"></textarea>
                        <button class="send-btn" id="sendBtn">‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Ticker Tab -->
            <div class="tab-pane" id="ticker">
                <div class="ios-card">
                    <div class="card-title">üîç Stock Analysis</div>
                    <div class="card-subtitle">Search any stock for comprehensive analysis</div>
                    <input type="text" class="ios-input" id="tickerInput" placeholder="Enter ticker (e.g., AAPL)" maxlength="6">
                    <button class="ios-btn" id="analyzeBtn">üìä Analyze Stock</button>
                </div>

                <div id="stockResult"></div>

                <div class="ios-card">
                    <div class="card-title">üìà Popular Stocks</div>
                    <div class="card-subtitle">Quick access to trending tickers</div>
                </div>
                <div class="ios-grid">
                    <div class="grid-button" onclick="analyzeStock('AAPL')">
                        <div class="grid-button-text">AAPL</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('TSLA')">
                        <div class="grid-button-text">TSLA</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('HOOD')">
                        <div class="grid-button-text">HOOD</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('SPY')">
                        <div class="grid-button-text">SPY</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('NVDA')">
                        <div class="grid-button-text">NVDA</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('QQQ')">
                        <div class="grid-button-text">QQQ</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('AMD')">
                        <div class="grid-button-text">AMD</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('META')">
                        <div class="grid-button-text">META</div>
                    </div>
                    <div class="grid-button" onclick="analyzeStock('GOOGL')">
                        <div class="grid-button-text">GOOGL</div>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div class="tab-pane" id="analysis">
                <div class="ios-card">
                    <div class="card-title">üî¨ Technical Analysis</div>
                    <div class="card-subtitle">Advanced indicators and market insights</div>
                    <div id="analysisContent">
                        <p style="color: var(--ios-text-secondary); text-align: center; padding: 20px;">
                            Search for a stock in the Ticker tab to see detailed technical analysis with RSI, MACD, support/resistance levels, and trading strategies.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Plays Tab -->
            <div class="tab-pane" id="plays">
                <div class="ios-card">
                    <div class="card-title">üéØ Smart Trading Plays</div>
                    <div class="card-subtitle">AI-generated opportunities with confidence scores</div>
                    
                    <div style="margin-bottom: 16px;">
                        <button class="ios-btn" style="width: 100%; margin-bottom: 8px;" onclick="generatePlays('all')">Generate All Plays</button>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                            <button class="ios-btn secondary" onclick="generatePlays('options')">Options</button>
                            <button class="ios-btn secondary" onclick="generatePlays('momentum')">Momentum</button>
                        </div>
                    </div>

                    <div style="background: var(--ios-secondary-background); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                        <div style="color: var(--ios-orange); font-weight: 600; margin-bottom: 6px;">üí° How Plays Are Generated:</div>
                        <div style="color: var(--ios-text-secondary); font-size: 14px; line-height: 1.4;">
                            ‚Ä¢ AI analyzes technical indicators (RSI, MACD, Volume)<br>
                            ‚Ä¢ Combines real-time sentiment data<br>
                            ‚Ä¢ Calculates confidence scores using machine learning<br>
                            ‚Ä¢ Provides entry/exit points with risk management
                        </div>
                    </div>

                    <div id="playsContent">
                        <div style="color: var(--ios-text-secondary); text-align: center; padding: 20px;">
                            Click "Generate All Plays" to see AI-generated trading opportunities based on current market conditions and technical analysis.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Tab -->
            <div class="tab-pane" id="market">
                <div class="ios-card">
                    <div class="card-title">üìä Market Dashboard</div>
                    <div class="card-subtitle">Major indices and market sentiment</div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 12px; color: var(--ios-text-primary);">Major Indices</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <div class="detail-item">
                                <div class="detail-label">S&P 500</div>
                                <div class="detail-value" id="spyPrice">Loading...</div>
                                <div class="stock-change" id="spyChange">---</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">NASDAQ</div>
                                <div class="detail-value" id="nasdaqPrice">Loading...</div>
                                <div class="stock-change" id="nasdaqChange">---</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">DOW JONES</div>
                                <div class="detail-value" id="dowPrice">Loading...</div>
                                <div class="stock-change" id="dowChange">---</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">VIX</div>
                                <div class="detail-value" id="vixPrice">Loading...</div>
                                <div class="stock-change" id="vixChange">---</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 12px; color: var(--ios-text-primary);">Market Sentiment</div>
                        <div id="sentimentContent">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading market sentiment analysis...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div class="tab-pane" id="alerts">
                <div class="ios-card">
                    <div class="card-title">üîî Market Alerts</div>
                    <div class="card-subtitle">Real-time monitoring and smart notifications</div>
                    
                    <button class="ios-btn" style="width: 100%; margin-bottom: 16px;" onclick="refreshAlerts()">üîÑ Refresh Alerts</button>

                    <div style="background: var(--ios-secondary-background); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                        <div style="color: var(--ios-orange); font-weight: 600; margin-bottom: 6px;">üö® Smart alerts monitor:</div>
                        <div style="color: var(--ios-text-secondary); font-size: 14px; line-height: 1.4;">
                            ‚Ä¢ Unusual volume spikes<br>
                            ‚Ä¢ Technical breakouts<br>
                            ‚Ä¢ Sentiment shifts<br>
                            ‚Ä¢ Extended hours activity
                        </div>
                    </div>

                    <div id="alertsContent">
                        <div style="color: var(--ios-text-secondary); text-align: center; padding: 20px;">
                            Click "Refresh Alerts" to scan the market for unusual activity and trading opportunities.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- iOS-style Tab Bar -->
        <div class="ios-tab-bar">
            <div class="tab-container">
                <div class="tab-item active" onclick="showTab('chat', this)">
                    <div class="tab-icon">üí¨</div>
                    <div class="tab-label">Chat</div>
                </div>
                <div class="tab-item" onclick="showTab('ticker', this)">
                    <div class="tab-icon">üìä</div>
                    <div class="tab-label">Ticker</div>
                </div>
                <div class="tab-item" onclick="showTab('analysis', this)">
                    <div class="tab-icon">üî¨</div>
                    <div class="tab-label">Analysis</div>
                </div>
                <div class="tab-item" onclick="showTab('plays', this)">
                    <div class="tab-icon">üéØ</div>
                    <div class="tab-label">Plays</div>
                </div>
                <div class="tab-item" onclick="showTab('market', this)">
                    <div class="tab-icon">üåê</div>
                    <div class="tab-label">Market</div>
                </div>
                <div class="tab-item" onclick="showTab('alerts', this)">
                    <div class="tab-icon">üîî</div>
                    <div class="tab-label">Alerts</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'chat';
        
        // Tab switching with iOS animations
        function showTab(tabName, element) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-pane');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Update tab bar
            const tabItems = document.querySelectorAll('.tab-item');
            tabItems.forEach(item => item.classList.remove('active'));
            element.classList.add('active');
            
            currentTab = tabName;
            
            // Load content based on tab
            if (tabName === 'market') {
                loadMarketData();
            }
            
            // Haptic feedback simulation
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
        }

        // Auto-resize chat input
        function autoResizeInput() {
            const input = document.getElementById('chatInput');
            input.style.height = 'auto';
            input.style.height = Math.min(input.scrollHeight, 100) + 'px';
        }

        // Chat functionality
        function initChat() {
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            
            chatInput.addEventListener('input', autoResizeInput);
            
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            sendBtn.addEventListener('click', sendMessage);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            autoResizeInput();
            
            // Show typing indicator
            const typingDiv = addChatMessage('ü§î Analyzing your request...', 'ai');
            
            // Send to Rolo AI
            sendToRoloAI(message, typingDiv);
        }

        function addChatMessage(text, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            messageDiv.innerHTML = `<div class="message-text">${text}</div>`;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return messageDiv;
        }

        async function sendToRoloAI(message, typingDiv) {
            try {
                // Use enhanced Rolo chat function (smart like Claude)
                const response = await fetch('/.netlify/functions/enhanced-rolo-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: message,
                        context: 'You are Rolo AI, an intelligent trading assistant like Claude. Be conversational, insightful, and provide actionable trading insights. Use real market knowledge and be helpful like a professional trader would be.'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                typingDiv.querySelector('.message-text').innerHTML = data.response || getFallbackResponse(message);
                
            } catch (error) {
                console.error('Chat error:', error);
                typingDiv.querySelector('.message-text').innerHTML = getFallbackResponse(message);
            }
        }

        function getFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return `Hey there! üëã I'm Rolo AI, your intelligent trading assistant. I can help you analyze stocks, discuss market trends, and generate trading ideas. Try asking me about a specific stock like "What do you think about AAPL?" or "Analyze TSLA for tomorrow."`;
            }
            
            if (lowerMessage.includes('analyze') || lowerMessage.includes('aapl') || lowerMessage.includes('tsla') || lowerMessage.includes('stock')) {
                return `I'd love to analyze that for you! For detailed stock analysis with real-time data, try searching in the Ticker tab. I can provide insights on technical patterns, market sentiment, and trading opportunities. What specific stock interests you?`;
            }
            
            if (lowerMessage.includes('market') || lowerMessage.includes('outlook')) {
                return `The market is always evolving! For live market data and sentiment analysis, check the Market tab. I can discuss current trends, volatility patterns, and sector rotations. What aspect of the market would you like to explore?`;
            }
            
            return `I'm having a brief connection issue, but I'm still here to help! Try exploring the different tabs for live market data, stock analysis, and trading plays. I'm designed to be your intelligent trading companion. What would you like to discuss about the markets?`;
        }

        // Ticker analysis
        function initTicker() {
            const tickerInput = document.getElementById('tickerInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            tickerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    analyzeStock();
                }
            });
            
            analyzeBtn.addEventListener('click', analyzeStock);
        }

        async function analyzeStock(symbol = null) {
            const input = document.getElementById('tickerInput');
            const ticker = symbol || input.value.trim().toUpperCase();
            
            if (!ticker) {
                showError('Please enter a stock ticker symbol');
                return;
            }
            
            if (symbol) {
                input.value = ticker;
            }
            
            const resultDiv = document.getElementById('stockResult');
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Fetching real-time data for ${ticker}...
                </div>
            `;
            
            try {
                // Get real stock data from Alpha Vantage ONLY (no mock data)
                const response = await fetch(`/.netlify/functions/stock-data?symbol=${ticker}&entitlement=realtime`);
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `<div class="error">‚ùå ${data.error}</div>`;
                    return;
                }
                
                displayStockData(data, ticker);
                
            } catch (error) {
                console.error('Stock analysis error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Unable to fetch data for ${ticker}
                        <br><br>This could be due to:
                        <br>‚Ä¢ Invalid ticker symbol
                        <br>‚Ä¢ API rate limits
                        <br>‚Ä¢ Market is closed
                        <br><br>Try again with a valid ticker like AAPL, TSLA, or SPY.
                    </div>
                `;
            }
        }

        function displayStockData(data, symbol) {
            const quote = data['Global Quote'] || data;
            
            if (!quote || (!quote['05. price'] && !quote.price)) {
                document.getElementById('stockResult').innerHTML = `
                    <div class="error">
                        ‚ùå No data available for ${symbol}. Please verify the ticker symbol and try again.
                    </div>
                `;
                return;
            }
            
            const price = parseFloat(quote['05. price'] || quote.price || 0);
            const change = parseFloat(quote['09. change'] || quote.change || 0);
            const changePercent = parseFloat(quote['10. change percent']?.replace('%', '') || quote.changePercent || 0);
            const volume = quote['06. volume'] || quote.volume || 'N/A';
            const high = quote['03. high'] || quote.high || 'N/A';
            const low = quote['04. low'] || quote.low || 'N/A';
            
            const changeClass = change >= 0 ? 'positive' : 'negative';
            const changeSign = change >= 0 ? '+' : '';
            
            document.getElementById('stockResult').innerHTML = `
                <div class="stock-display">
                    <div class="stock-header">
                        <div class="stock-symbol">${symbol}</div>
                        <div>
                            <div class="stock-price">$${price.toFixed(2)}</div>
                            <div class="stock-change ${changeClass}">
                                ${changeSign}$${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)
                            </div>
                        </div>
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <div class="detail-label">Volume</div>
                            <div class="detail-value">${formatVolume(volume)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">High</div>
                            <div class="detail-value">$${typeof high === 'number' ? high.toFixed(2) : high}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Low</div>
                            <div class="detail-value">$${typeof low === 'number' ? low.toFixed(2) : low}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Source</div>
                            <div class="detail-value" style="color: var(--ios-green);">Live Data</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Update analysis tab
            updateAnalysisTab(symbol, data);
        }

        function updateAnalysisTab(symbol, data) {
            const analysisContent = document.getElementById('analysisContent');
            const quote = data['Global Quote'] || data;
            const price = parseFloat(quote['05. price'] || quote.price || 0);
            
            analysisContent.innerHTML = `
                <div style="padding: 16px;">
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--ios-text-primary);">${symbol} Technical Analysis</div>
                    <div style="background: var(--ios-secondary-background); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                        <div style="color: var(--ios-text-secondary); font-size: 14px; line-height: 1.4;">
                            <strong>Current Price:</strong> $${price.toFixed(2)}<br>
                            <strong>Status:</strong> Live data from Alpha Vantage<br>
                            <strong>Analysis:</strong> Professional technical indicators available with enhanced data feeds
                        </div>
                    </div>
                    <div style="color: var(--ios-text-secondary); font-size: 14px; text-align: center; margin-top: 16px;">
                        Ask Rolo AI in Chat: "Analyze ${symbol} with technical indicators" for detailed insights
                    </div>
                </div>
            `;
        }

        function formatVolume(volume) {
            if (volume === 'N/A') return volume;
            const vol = parseInt(volume);
            if (vol >= 1000000) {
                return (vol / 1000000).toFixed(1) + 'M';
            } else if (vol >= 1000) {
                return (vol / 1000).toFixed(1) + 'K';
            }
            return vol.toString();
        }

        // Market data loading (Alpha Vantage ONLY)
        async function loadMarketData() {
            const indices = [
                { symbol: 'SPY', priceId: 'spyPrice', changeId: 'spyChange' },
                { symbol: 'QQQ', priceId: 'nasdaqPrice', changeId: 'nasdaqChange' },
                { symbol: 'DIA', priceId: 'dowPrice', changeId: 'dowChange' },
                { symbol: 'VIX', priceId: 'vixPrice', changeId: 'vixChange' }
            ];
            
            for (const index of indices) {
                try {
                    const response = await fetch(`/.netlify/functions/stock-data?symbol=${index.symbol}&entitlement=realtime`);
                    const data = await response.json();
                    
                    if (data && !data.error) {
                        const quote = data['Global Quote'] || data;
                        const price = parseFloat(quote['05. price'] || quote.price || 0);
                        const change = parseFloat(quote['09. change'] || quote.change || 0);
                        const changePercent = parseFloat(quote['10. change percent']?.replace('%', '') || quote.changePercent || 0);
                        
                        document.getElementById(index.priceId).textContent = `$${price.toFixed(2)}`;
                        
                        const changeElement = document.getElementById(index.changeId);
                        const changeSign = change >= 0 ? '+' : '';
                        changeElement.textContent = `${changeSign}${change.toFixed(2)} (${changeSign}${changePercent.toFixed(2)}%)`;
                        changeElement.className = `stock-change ${change >= 0 ? 'positive' : 'negative'}`;
                    } else {
                        document.getElementById(index.priceId).textContent = 'Error';
                        document.getElementById(index.changeId).textContent = 'Data unavailable';
                    }
                } catch (error) {
                    console.error(`Error loading ${index.symbol}:`, error);
                    document.getElementById(index.priceId).textContent = 'Error';
                    document.getElementById(index.changeId).textContent = 'Unable to load';
                }
            }
            
            // Load market sentiment
            loadMarketSentiment();
        }

        async function loadMarketSentiment() {
            try {
                const response = await fetch('/.netlify/functions/stock-data?function=NEWS_SENTIMENT&tickers=SPY,QQQ,AAPL,TSLA');
                const data = await response.json();
                
                if (data && data.feed && data.feed.length > 0) {
                    const sentiments = data.feed.slice(0, 10).map(article => ({
                        label: article.overall_sentiment_label,
                        score: article.overall_sentiment_score
                    }));
                    
                    const avgScore = sentiments.reduce((sum, s) => sum + s.score, 0) / sentiments.length;
                    const bullishCount = sentiments.filter(s => s.label === 'Bullish').length;
                    
                    let sentimentText = 'Neutral';
                    let sentimentColor = 'var(--ios-text-secondary)';
                    
                    if (avgScore > 0.1) {
                        sentimentText = 'Bullish';
                        sentimentColor = 'var(--ios-green)';
                    } else if (avgScore < -0.1) {
                        sentimentText = 'Bearish';
                        sentimentColor = 'var(--ios-red)';
                    }
                    
                    document.getElementById('sentimentContent').innerHTML = `
                        <div style="text-align: center; padding: 16px;">
                            <div style="font-size: 20px; font-weight: 600; color: ${sentimentColor}; margin-bottom: 6px;">
                                ${sentimentText}
                            </div>
                            <div style="color: var(--ios-text-secondary); margin-bottom: 12px; font-size: 14px;">
                                Based on ${sentiments.length} recent articles
                            </div>
                            <div style="background: var(--ios-secondary-background); border-radius: 8px; padding: 12px;">
                                <div style="color: var(--ios-green); font-size: 14px;">${bullishCount} Bullish</div>
                                <div style="color: var(--ios-red); font-size: 14px;">${sentiments.length - bullishCount} Bearish/Neutral</div>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('sentimentContent').innerHTML = `
                        <div style="text-align: center; padding: 16px; color: var(--ios-text-secondary); font-size: 14px;">
                            Market sentiment data temporarily unavailable
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Sentiment loading error:', error);
                document.getElementById('sentimentContent').innerHTML = `
                    <div style="text-align: center; padding: 16px; color: var(--ios-text-secondary); font-size: 14px;">
                        Unable to load sentiment data - check connection
                    </div>
                `;
            }
        }

        // Generate trading plays (NO MOCK DATA)
        async function generatePlays(type) {
            const playsContent = document.getElementById('playsContent');
            playsContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Generating smart plays...
                </div>
            `;
            
            try {
                const response = await fetch('/.netlify/functions/smart-plays', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: type })
                });
                
                if (!response.ok) {
                    throw new Error('Function not available');
                }
                
                const data = await response.json();
                displayPlays(data.plays || []);
                
            } catch (error) {
                console.error('Plays generation error:', error);
                playsContent.innerHTML = `
                    <div style="color: var(--ios-text-secondary); text-align: center; padding: 20px; font-size: 14px;">
                        Smart plays function not yet available. Ask Rolo AI in Chat for trading strategies and opportunities based on current market conditions.
                    </div>
                `;
            }
        }

        function displayPlays(plays) {
            const playsContent = document.getElementById('playsContent');
            
            if (plays.length === 0) {
                playsContent.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--ios-text-secondary); font-size: 14px;">
                        No plays generated. Market conditions may not be optimal for the selected strategy type.
                    </div>
                `;
                return;
            }
            
            const playsHTML = plays.map(play => `
                <div style="background: var(--ios-card-background); border-radius: 8px; padding: 12px; margin-bottom: 8px; border: 0.5px solid var(--ios-border-color);">
                    <div style="font-weight: 600; margin-bottom: 4px; color: var(--ios-text-primary);">${play.title}</div>
                    <div style="color: var(--ios-text-secondary); font-size: 14px; margin-bottom: 6px;">${play.description}</div>
                    <div style="color: ${play.confidence > 70 ? 'var(--ios-green)' : 'var(--ios-orange)'}; font-size: 14px; font-weight: 500;">
                        Confidence: ${play.confidence}%
                    </div>
                </div>
            `).join('');
            
            playsContent.innerHTML = playsHTML;
        }

        // Refresh alerts (NO MOCK DATA)
        async function refreshAlerts() {
            const alertsContent = document.getElementById('alertsContent');
            alertsContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Scanning market for alerts...
                </div>
            `;
            
            try {
                const response = await fetch('/.netlify/functions/realtime-alerts');
                const data = await response.json();
                
                if (data.alerts && data.alerts.length > 0) {
                    const alertsHTML = data.alerts.map(alert => `
                        <div style="background: var(--ios-card-background); border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 3px solid ${alert.priority === 'high' ? 'var(--ios-red)' : 'var(--ios-orange)'}; border: 0.5px solid var(--ios-border-color);">
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--ios-text-primary);">${alert.title}</div>
                            <div style="color: var(--ios-text-secondary); font-size: 14px; line-height: 1.4;">${alert.description}</div>
                            <div style="color: var(--ios-text-secondary); font-size: 12px; margin-top: 6px;">${alert.timestamp}</div>
                        </div>
                    `).join('');
                    
                    alertsContent.innerHTML = alertsHTML;
                } else {
                    alertsContent.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--ios-text-secondary); font-size: 14px;">
                            No active alerts at this time. Market conditions are within normal ranges.
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Alerts refresh error:', error);
                alertsContent.innerHTML = `
                    <div style="color: var(--ios-text-secondary); text-align: center; padding: 20px; font-size: 14px;">
                        Real-time alerts function not yet available. Ask Rolo AI in Chat for current market conditions and unusual activity.
                    </div>
                `;
            }
        }

        function showError(message) {
            const resultDiv = document.getElementById('stockResult');
            resultDiv.innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initChat();
            initTicker();
            
            // Load initial market data
            setTimeout(() => {
                loadMarketData();
            }, 1000);
            
            // Update status indicator
            updateStatus();
            
            // Auto-refresh market data every 30 seconds
            setInterval(loadMarketData, 30000);
        });

        function updateStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            // Check if market is open (simplified)
            const now = new Date();
            const hour = now.getHours();
            const isWeekday = now.getDay() >= 1 && now.getDay() <= 5;
            const isMarketHours = hour >= 9 && hour < 16;
            
            if (isWeekday && isMarketHours) {
                statusDot.style.background = 'var(--ios-green)';
                statusText.textContent = 'Live';
            } else if (isWeekday && (hour >= 4 && hour < 9) || (hour >= 16 && hour < 20)) {
                statusDot.style.background = 'var(--ios-orange)';
                statusText.textContent = 'Extended';
            } else {
                statusDot.style.background = 'var(--ios-gray)';
                statusText.textContent = 'Closed';
            }
        }
    </script>
</body>
</html>
