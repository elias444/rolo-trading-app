  <div id="ticker" class="tab-content">
    <div class="section">
      <h2>ðŸ“ˆ Ticker Info</h2>
      <div id="extended-hours-indicator">ðŸ”® Extended Hours Pricing</div>
      <p>Coming soon: Live stock data with sentiment overlays.</p>
    </div>
  </div>

  <div id="options" class="tab-content">
    <div class="section">
      <h2>ðŸ§  Options</h2>
      <p>Best strike suggestions based on volatility and play confidence.</p>
    </div>
  </div>

  <div id="plays" class="tab-content">
    <div class="section">
      <h2>ðŸ’¡ Smart Plays</h2>
      <div id="smart-plays-output">
        <p>Scanning opportunities across RSI, MACD, and newsâ€¦</p>
      </div>
    </div>
  </div>

  <div id="sentiment" class="tab-content">
    <div class="section">
      <h2>ðŸ“° Market Sentiment</h2>
      <div id="sentiment-feed">
        <p>Loading sentiment headlinesâ€¦</p>
      </div>
    </div>
  </div>
<script>
// Tab Switching
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  [...document.querySelectorAll('.tab-button')].forEach(btn => {
    if (btn.textContent.toLowerCase().includes(tabId)) btn.classList.add('active');
  });
  if (tabId === "sentiment") loadSentiment();
  if (tabId === "plays") loadSmartPlays();
}

// GPT Chat
document.getElementById('chat-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const input = document.getElementById('chat-input');
  const msg = input.value.trim();
  if (!msg) return;
  appendBubble(msg, 'user');
  input.value = '';
  try {
    const res = await fetch('/.netlify/functions/chatgpt-rolo-chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    appendBubble(data.reply, 'ai');
  } catch {
    appendBubble("Rolo hit a snag. Try again later.", 'ai');
  }
});

function appendBubble(text, type) {
  const bubble = document.createElement('div');
  bubble.className = `chat-bubble ${type}`;
  bubble.textContent = text;
  document.getElementById('chat-window').appendChild(bubble);
}

// Sentiment Headlines
async function loadSentiment() {
  const container = document.getElementById('sentiment-feed');
  container.innerHTML = '<p>Loadingâ€¦</p>';
  try {
    const response = await fetch(`https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=AAPL,TSLA,NVDA&apikey=${ALPHA_VANTAGE_API_KEY}`);
    const data = await response.json();
    const headlines = data?.feed?.slice(0, 5) || [];
    container.innerHTML = '';
    headlines.forEach(item => {
      const div = document.createElement('div');
      div.className = `sentiment-item sentiment-${item.overall_sentiment_label.toLowerCase()}`;
      div.innerHTML = `<span class="ticker">${item.ticker}:</span> <a href="${item.url}" target="_blank">${item.title}</a><br><em>Source:</em> ${item.source} | Sentiment: ${item.overall_sentiment_label} (${Math.round(item.relevance_score * 100)}%)`;
      container.appendChild(div);
    });
  } catch {
    container.innerHTML = '<p>Failed to load sentiment data.</p>';
  }
}

// Smart Play Scanner (Starter Logic)
async function loadSmartPlays
async function fetchRSI(symbol) {
  const url = `https://www.alphavantage.co/query?function=RSI&symbol=${symbol}&interval=15min&time_period=14&series_type=close&apikey=${ALPHA_VANTAGE_API_KEY}`;
  const res = await fetch(url); const data = await res.json();
  const rsiData = data["Technical Analysis: RSI"];
  const latestTime = Object.keys(rsiData)[0];
  return parseFloat(rsiData[latestTime]["RSI"]);
}

async function fetchMACD(symbol) {
  const url = `https://www.alphavantage.co/query?function=MACD&symbol=${symbol}&interval=15min&series_type=close&apikey=${ALPHA_VANTAGE_API_KEY}`;
  const res = await fetch(url); const data = await res.json();
  const macdData = data["Technical Analysis: MACD"];
  const latestTime = Object.keys(macdData)[0];
  const histogram = parseFloat(macdData[latestTime]["MACD_Histogram"]);
  return histogram;
}

async function fetchSentimentScore(symbol) {
  const url = `https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}`;
  const res = await fetch(url); const data = await res.json();
  const score = data?.feed?.[0]?.relevance_score || 0.5;
  return Math.round(score * 100);
}

function calculateConfidence(rsi, macd, sentiment) {
  let score = 0;
  if (rsi < 30) score += 30;
  if (macd > 0) score += 30;
  score += sentiment * 0.4;
  return Math.min(100, Math.round(score));
}

async function loadSmartPlays() {
  const output = document.getElementById("smart-plays-output");
  output.innerHTML = "<p>Scanning tickers: AAPL, TSLA, NVDAâ€¦</p>";
  const tickers = ["AAPL", "TSLA", "NVDA"];
  let html = "";

  for (const symbol of tickers) {
    const [rsi, macd, sentiment] = await Promise.all([
      fetchRSI(symbol),
      fetchMACD(symbol),
      fetchSentimentScore(symbol)
    ]);

    const confidence = calculateConfidence(rsi, macd, sentiment);
    html += `
      <div class="section">
        <strong>${symbol}</strong>: RSI ${rsi}, MACD ${macd.toFixed(2)}, Sentiment ${sentiment}%<br>
        Confidence Score: <span style="color:${confidence>80?'green':confidence>60?'orange':'red'}">${confidence}%</span>
      </div>
    `;
  }

  output.innerHTML = html;
}
</script>
</body>
</html>
