<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolo AI Trading - Professional Options Analysis</title>
    <meta name="description" content="Professional Options Trading Assistant powered by Claude AI, live market data, Discord sentiment, and Alpaca brokerage">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f8fafc; 
            -webkit-text-size-adjust: 100%;
        }
        .app { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .header { 
            background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%); 
            color: white; 
            padding: 1rem; 
            flex-shrink: 0;
            z-index: 10;
        }
        .header h1 { font-size: 1.125rem; margin-bottom: 0.25rem; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 0.8rem; }
        .status-bar { 
            background: #dcfce7; 
            color: #166534; 
            padding: 0.5rem 1rem; 
            font-size: 0.8rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            flex-shrink: 0;
            z-index: 10;
        }
        .status-dot { width: 6px; height: 6px; background: #22c55e; border-radius: 50%; }
        .content { 
            flex: 1; 
            padding: 0.5rem; 
            padding-bottom: 8rem;
            overflow-y: auto; 
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            transition: all 0.3s ease;
            min-height: 0;
            max-height: calc(100vh - 200px);
        }
        
        .input-section {
            position: fixed;
            bottom: 4.5rem;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            z-index: 60;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: block;
        }
        
        .scrollable-content {
            padding-bottom: 4rem;
            min-height: 100%;
        }
        
        .page-content {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .page-content.fade-out {
            opacity: 0;
            transform: translateX(-20px);
        }
        .card { 
            background: white; 
            padding: 1rem; 
            margin-bottom: 0.75rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .tabs { 
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(229, 231, 235, 0.5); 
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 100;
            padding: 0.5rem;
            height: 4.5rem;
            transition: all 0.3s ease;
        }
        .tab { 
            flex: 1; 
            padding: 0.5rem 0.25rem; 
            text-align: center; 
            cursor: pointer; 
            border: none; 
            background: none; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            gap: 0.125rem;
            font-size: 0.7rem;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 3.5rem;
            border-radius: 0.75rem;
            position: relative;
            transform: scale(1);
        }
        .tab:active { 
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }
        .tab.active { 
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            color: #7c3aed; 
            font-weight: 600; 
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
            transform: scale(1.02);
        }
        .tab.active::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: #7c3aed;
            border-radius: 1px;
        }
        .tab-icon { font-size: 1.2rem; }
        .tab-label { font-size: 0.65rem; font-weight: 500; }
        
        .home-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #7c3aed;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .input-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .input { 
            flex: 1; 
            padding: 0.875rem; 
            border: 2px solid #e2e8f0; 
            border-radius: 0.75rem; 
            outline: none; 
            font-size: 16px;
            background: #fafafa;
        }
        .input:focus { border-color: #7c3aed; background: white; }
        .btn { 
            padding: 0.875rem 1rem; 
            background: #7c3aed; 
            color: white; 
            border: none; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-small { padding: 0.5rem 0.75rem; font-size: 0.75rem; }
        
        .messages { 
            height: 45vh;
            min-height: 250px;
            max-height: 400px;
            overflow-y: auto; 
            border: 2px solid #e2e8f0; 
            padding: 0.75rem; 
            margin-bottom: 1rem; 
            border-radius: 0.75rem; 
            background: #fafafa;
            -webkit-overflow-scrolling: touch;
        }
        .message { margin-bottom: 1rem; }
        .message.user { text-align: right; }
        .message-content { 
            display: inline-block; 
            max-width: 85%; 
            padding: 0.75rem 1rem; 
            border-radius: 1rem; 
            line-height: 1.4; 
            white-space: pre-line;
            font-size: 0.9rem;
        }
        .message.user .message-content { background: #7c3aed; color: white; }
        .message.assistant .message-content { background: white; color: #1f2937; border: 1px solid #e2e8f0; }
        .message-meta { font-size: 0.7rem; color: #6b7280; margin-top: 0.25rem; }
        
        .stock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
        .market-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; }
        .stat { text-align: center; padding: 0.75rem; background: #f8fafc; border-radius: 0.75rem; border: 1px solid #e2e8f0; }
        .stat-label { font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500; }
        .stat-value { font-size: 1.1rem; font-weight: 700; }
        .price-positive { color: #22c55e; }
        .price-negative { color: #ef4444; }
        
        .sentiment-indicator {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 700;
        }
        .sentiment-fear { background: #fee2e2; color: #dc2626; }
        .sentiment-neutral { background: #fef3c7; color: #d97706; }
        .sentiment-greed { background: #dcfce7; color: #16a34a; }
        
        .discord-sentiment {
            background: linear-gradient(135deg, #e0f2fe 0%, #81d4fa 100%);
            border: 2px solid #29b6f6;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .options-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
            color: #92400e;
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 2px solid #f59e0b;
            text-align: center;
        }
        
        .play-card {
            border: 2px solid #e2e8f0; 
            border-radius: 0.75rem; 
            padding: 1rem; 
            margin-bottom: 1rem; 
            background: white;
        }
        
        .alert-item {
            padding: 0.75rem; 
            border-radius: 0.75rem; 
            margin-bottom: 0.75rem; 
            border-left: 4px solid;
        }
        .alert-success { background: #dcfce7; border-color: #22c55e; }
        .alert-info { background: #faf5ff; border-color: #7c3aed; }
        .alert-warning { background: #fef3c7; border-color: #eab308; }
        
        .sentiment-bullish { color: #22c55e; font-weight: 700; }
        .sentiment-bearish { color: #ef4444; font-weight: 700; }
        .sentiment-neutral-text { color: #d97706; font-weight: 700; }
        
        @media (max-width: 768px) {
            .stock-grid { grid-template-columns: 1fr; gap: 0.5rem; }
            .market-grid { grid-template-columns: 1fr 1fr; gap: 0.5rem; }
            .messages { height: 40vh; min-height: 200px; }
            .header { padding: 0.75rem; }
            .content { 
                padding: 0.5rem; 
                padding-bottom: 8rem; 
                max-height: calc(100vh - 180px);
            }
            .tabs { height: 4.5rem; padding: 0.75rem 0; }
            .tab { min-height: 3rem; }
            .tab-icon { font-size: 1.1rem; }
            .tab-label { font-size: 0.6rem; }
            .scrollable-content {
                padding-bottom: 5rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app">
            <div class="header">
                <h1>🤖 Rolo AI Trading</h1>
                <p>AI Assistant + Live Market Data + Discord Sentiment + Alpaca Brokerage</p>
            </div>
            
            <div class="status-bar">
                <div class="status-dot"></div>
                <span>🟢 Live APIs: Claude AI • Discord Sentiment • Yahoo Finance • Alpha Vantage • Alpaca</span>
            </div>
            
            <div class="content" id="content">
                <!-- Content will be inserted here -->
            </div>
            
            <div class="input-section" id="inputSection">
                <div class="input-group">
                    <input 
                        type="text" 
                        class="input" 
                        id="messageInput"
                        placeholder="Ask: 'Show my portfolio and suggest trades' or 'AAPL options strategy with my buying power'"
                        onkeypress="if(event.key==='Enter') sendMessage()"
                    />
                    <button class="btn" onclick="sendMessage()" id="sendBtn">
                        ➤
                    </button>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('chat')" id="chat-tab">
                    <div class="tab-icon">💬</div>
                    <div class="tab-label">Chat</div>
                </button>
                <button class="tab" onclick="switchTab('ticker')" id="ticker-tab">
                    <div class="tab-icon">🔍</div>
                    <div class="tab-label">Ticker</div>
                </button>
                <button class="tab" onclick="switchTab('analysis')" id="analysis-tab">
                    <div class="tab-icon">📊</div>
                    <div class="tab-label">Analysis</div>
                </button>
                <button class="tab" onclick="switchTab('plays')" id="plays-tab">
                    <div class="tab-icon">📈</div>
                    <div class="tab-label">Plays</div>
                </button>
                <button class="tab" onclick="switchTab('alerts')" id="alerts-tab">
                    <div class="tab-icon">🔔</div>
                    <div class="tab-label">Alerts</div>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Global state - NO MOCK DATA
        let currentTab = 'chat';
        let messages = [
            {
                id: 1,
                type: 'assistant',
                text: "🤖 **Rolo AI Trading Assistant**\n\nI'm your professional options trading AI powered by Claude with LIVE market intelligence AND Alpaca brokerage integration. I provide:\n\n✅ **Real-time market analysis** with VIX, sector data & sentiment\n✅ **Discord social sentiment** from trading communities\n✅ **Alpaca brokerage data** - your real account, buying power, positions\n✅ **Specific options strategies** with exact strikes and entry/exit points\n✅ **Professional risk management** based on your account size\n✅ **Live stock plays** from comprehensive market feeds\n\n**No mock data - everything is live and actionable.**\n\nAsk me:\n• \"Show my Alpaca portfolio and suggest trades\"\n• \"AAPL options strategy with my current buying power\"\n• \"What's Discord saying about SPY today?\"\n• \"Best trades based on live alerts + my account\"\n\n**Ready to analyze real trades with live market + account data!** 🚀"
            }
        ];
        let isTyping = false;
        let apiConnected = true;
        let stockData = {};
        let ticker = '';
        let marketData = {};
        let discordSentiment = {};
        let liveAlerts = [];
        let alpacaData = null;
        let analysisResults = {};

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            const inputSection = document.getElementById('inputSection');
            const content = document.getElementById('content');
            
            if (currentTab === 'chat') {
                inputSection.style.display = 'block';
                content.style.paddingBottom = '8rem';
            }
            
            renderCurrentTab();
            loadMarketData();
            loadDiscordSentiment();
            loadAlpacaData();
        });

        // ALPACA INTEGRATION
        async function loadAlpacaData() {
            try {
                const response = await fetch('/.netlify/functions/alpaca-data');
                const data = await response.json();
                
                if (data.error) {
                    console.log('Alpaca unavailable:', data.error);
                    alpacaData = { error: data.error };
                } else {
                    alpacaData = data;
                    console.log('✅ Alpaca connected');
                }
            } catch (error) {
                console.error('Alpaca connection error:', error);
                alpacaData = { error: error.message };
            }
        }

        // ENHANCED STOCK DATA WITH ALPACA + ALPHA VANTAGE
        async function fetchRealStockData(symbol, showLoading = true) {
            if (showLoading) setIsLoadingStock(true);
            setApiError(null);

            try {
                // Try Alpaca first for real-time data
                let stockResult = null;
                
                try {
                    const alpacaResponse = await fetch(`/.netlify/functions/alpaca-stock-data?symbol=${symbol}`);
                    const alpacaData = await alpacaResponse.json();
                    
                    if (!alpacaData.error && !alpacaData.fallback) {
                        stockResult = alpacaData;
                        console.log(`✅ Using Alpaca data for ${symbol}`);
                    }
                } catch (alpacaError) {
                    console.log('🔄 Alpaca unavailable, trying Alpha Vantage...');
                }
                
                // Fallback to Alpha Vantage if Alpaca fails
                if (!stockResult) {
                    const response = await fetch(`/.netlify/functions/stock-data?symbol=${symbol}`);
                    const data = await response.json();
                    
                    if (!data.error) {
                        stockResult = data;
                        stockResult.source = 'alpha_vantage';
                        console.log(`✅ Using Alpha Vantage data for ${symbol}`);
                    } else {
                        throw new Error(data.error);
                    }
                }
                
                setStockData(prev => ({
                    ...prev,
                    [symbol]: stockResult
                }));

                return stockResult;
                
            } catch (error) {
                console.error('❌ All APIs failed for', symbol, ':', error);
                setApiError(error.message);
                
                // NO MOCK DATA - Just return error
                setStockData(prev => ({
                    ...prev,
                    [symbol]: { error: error.message }
                }));
                
                throw error;
            } finally {
                if (showLoading) setIsLoadingStock(false);
            }
        }

        // DISCORD SENTIMENT LOADING - NO MOCK DATA
        async function loadDiscordSentiment(symbol = null) {
            try {
                const url = symbol ? 
                    `/.netlify/functions/discord-sentiment?symbol=${symbol}` : 
                    '/.netlify/functions/discord-sentiment';
                    
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) {
                    console.log('Discord sentiment unavailable:', data.error);
                    // NO MOCK DATA
                    discordSentiment = {
                        overall: 'unavailable',
                        volume: 0,
                        tickers: {},
                        error: data.error,
                        timestamp: new Date().toISOString()
                    };
                } else {
                    discordSentiment = data;
                }
                
                return discordSentiment;
            } catch (error) {
                console.error('Discord sentiment error:', error);
                // NO MOCK DATA
                discordSentiment = {
                    overall: 'unavailable',
                    volume: 0,
                    tickers: {},
                    error: error.message,
                    timestamp: new Date().toISOString()
                };
                return discordSentiment;
            }
        }

        // MARKET DATA LOADING - NO MOCK DATA
        async function loadMarketData() {
            try {
                const symbols = ['^GSPC', '^IXIC', '^DJI', '^VIX'];
                const results = await Promise.all(
                    symbols.map(async (symbol) => {
                        try {
                            const response = await fetch(`/.netlify/functions/stock-data?symbol=${symbol}`);
                            const data = await response.json();
                            
                            if (!data.error) {
                                return data;
                            } else {
                                console.error(`Market data failed for ${symbol}:`, data.error);
                                return null; // NO MOCK DATA
                            }
                        } catch (error) {
                            console.error(`Error fetching ${symbol}:`, error);
                            return null; // NO MOCK DATA
                        }
                    })
                );
                
                marketData = {
                    sp500: results[0],
                    nasdaq: results[1], 
                    dow: results[2],
                    vix: results[3],
                    timestamp: new Date()
                };
                
                return marketData;
            } catch (error) {
                console.error('Market data error:', error);
                return null;
            }
        }

        // COMPREHENSIVE FEEDS LOADING - RESTORED FROM ORIGINAL
        async function loadComprehensiveFeeds() {
            updateFeedStatus('🔄 Loading comprehensive market intelligence from all sources...');
            
            try {
                // Clear previous alerts
                liveAlerts = [];
                
                // Load Alpaca account data first
                await loadAlpacaAccountFeeds();
                
                // Load all other feeds in parallel
                const [enhancedResponse, additionalResponse] = await Promise.all([
                    fetch('/.netlify/functions/enhanced-feeds').catch(() => null),
                    fetch('/.netlify/functions/additional-market-data').catch(() => null)
                ]);
                
                // Process enhanced feeds
                if (enhancedResponse) {
                    try {
                        const enhancedData = await enhancedResponse.json();
                        if (enhancedData && enhancedData.feeds) {
                            liveAlerts = [...liveAlerts, ...enhancedData.feeds];
                        }
                    } catch (error) {
                        console.error('Enhanced feeds error:', error);
                    }
                }
                
                // Process additional feeds
                if (additionalResponse) {
                    try {
                        const additionalData = await additionalResponse.json();
                        if (additionalData && additionalData.feeds) {
                            liveAlerts = [...liveAlerts, ...additionalData.feeds];
                        }
                    } catch (error) {
                        console.error('Additional feeds error:', error);
                    }
                }
                
                // Load fallback feeds if no API feeds available
                if (liveAlerts.length < 5) {
                    await loadFallbackFeeds();
                }
                
                // Process and display all feeds
                displayLiveAlerts();
                
                const totalFeeds = liveAlerts.length;
                updateFeedStatus(`✅ ${totalFeeds} live feeds loaded • Alpaca + Reddit + Market Data • ${new Date().toLocaleTimeString()}`);
                
            } catch (error) {
                console.error('Error loading comprehensive feeds:', error);
                updateFeedStatus('⚠️ Some feeds unavailable • Loading available data...');
                await loadFallbackFeeds();
                displayLiveAlerts();
            }
        }

        // ALPACA ACCOUNT FEEDS
        async function loadAlpacaAccountFeeds() {
            try {
                if (!alpacaData) await loadAlpacaData();
                
                if (alpacaData && !alpacaData.error && alpacaData.account) {
                    liveAlerts.push({
                        id: 'alpaca_account_' + Date.now(),
                        source: 'Your Alpaca Account',
                        title: `🏦 Portfolio: $${parseFloat(alpacaData.account.portfolio_value).toFixed(2)}`,
                        content: `Buying Power: $${parseFloat(alpacaData.account.buying_power).toFixed(2)} • Cash: $${parseFloat(alpacaData.account.cash).toFixed(2)} • Type: ${alpacaData.account.pattern_day_trader ? 'PDT' : 'Standard'} • Paper Trading Environment`,
                        type: 'alpaca_account',
                        timestamp: new Date(),
                        priority: 'high'
                    });
                }
            } catch (error) {
                console.error('Alpaca account feeds error:', error);
            }
        }

        // FALLBACK FEEDS LOADING
        async function loadFallbackFeeds() {
            try {
                // Load Reddit feeds
                await loadRedditFeeds();
                
                // Load financial news
                await loadFinancialNews();
                
                // Load earnings calendar
                await loadEarningsCalendar();
                
                // Load market sentiment
                await loadMarketSentimentFeeds();
                
            } catch (error) {
                console.error('Fallback feeds error:', error);
            }
        }

        // REDDIT FEEDS LOADING
        async function loadRedditFeeds() {
            const subreddits = ['wallstreetbets', 'options', 'SecurityAnalysis', 'investing', 'thetagang'];
            
            for (const subreddit of subreddits) {
                try {
                    const response = await fetch(`https://www.reddit.com/r/${subreddit}/hot.json?limit=10`);
                    const data = await response.json();
                    
                    if (data && data.data && data.data.children) {
                        data.data.children.forEach(post => {
                            const postData = post.data;
                            const tickers = extractTickers(postData.title + ' ' + (postData.selftext || ''));
                            
                            if (tickers.length > 0 || isTradeRelevant(postData.title)) {
                                liveAlerts.push({
                                    id: postData.id,
                                    source: `r/${subreddit}`,
                                    title: postData.title,
                                    content: (postData.selftext || '').substring(0, 200),
                                    tickers: tickers,
                                    score: postData.score,
                                    comments: postData.num_comments,
                                    url: `https://reddit.com${postData.permalink}`,
                                    timestamp: new Date(postData.created_utc * 1000),
                                    type: 'reddit_feed',
                                    priority: postData.score > 1000 ? 'high' : 'medium'
                                });
                            }
                        });
                    }
                } catch (error) {
                    console.error(`Error loading r/${subreddit}:`, error);
                }
                
                // Rate limiting
                await new Promise(resolve => setTimeout(resolve, 100));
            }
        }

        // FINANCIAL NEWS LOADING
        async function loadFinancialNews() {
            try {
                const API_KEY = 'MAQEUTLGYYXC1HF1';
                const response = await fetch(`https://www.alphavantage.co/query?function=NEWS_SENTIMENT&topics=technology,finance&limit=20&apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data && data.feed) {
                    data.feed.slice(0, 10).forEach(article => {
                        const tickers = article.ticker_sentiment ? 
                                      article.ticker_sentiment.map(t => t.ticker) : 
                                      extractTickers(article.title);
                        
                        liveAlerts.push({
                            id: article.url,
                            source: article.source,
                            title: article.title,
                            content: article.summary.substring(0, 200),
                            tickers: tickers,
                            sentiment: article.overall_sentiment_label,
                            url: article.url,
                            timestamp: new Date(article.time_published),
                            type: 'financial_news',
                            priority: 'medium'
                        });
                    });
                }
            } catch (error) {
                console.error('Financial news error:', error);
            }
        }

        // EARNINGS CALENDAR LOADING
        async function loadEarningsCalendar() {
            try {
                const API_KEY = 'MAQEUTLGYYXC1HF1';
                const response = await fetch(`https://www.alphavantage.co/query?function=EARNINGS_CALENDAR&horizon=1month&apikey=${API_KEY}`);
                const csvData = await response.text();
                
                const lines = csvData.split('\n').slice(1, 11); // First 10 earnings
                
                lines.forEach(line => {
                    const [symbol, name, reportDate] = line.split(',');
                    
                    if (symbol && reportDate && symbol.length <= 5) {
                        liveAlerts.push({
                            id: 'earnings_' + symbol + '_' + reportDate,
                            source: 'Earnings Calendar',
                            title: `📅 ${symbol} Earnings: ${reportDate}`,
                            content: `${name || symbol} reports earnings on ${reportDate}. Options volatility expected.`,
                            tickers: [symbol],
                            type: 'earnings',
                            timestamp: new Date(reportDate),
                            priority: 'high'
                        });
                    }
                });
            } catch (error) {
                console.error('Earnings calendar error:', error);
            }
        }

        // MARKET SENTIMENT FEEDS
        async function loadMarketSentimentFeeds() {
            try {
                // Analyze existing alerts for sentiment
                const tickerMentions = {};
                
                liveAlerts.forEach(alert => {
                    if (alert.tickers) {
                        alert.tickers.forEach(ticker => {
                            if (!tickerMentions[ticker]) {
                                tickerMentions[ticker] = { count: 0, sources: new Set() };
                            }
                            tickerMentions[ticker].count += 1;
                            tickerMentions[ticker].sources.add(alert.source);
                        });
                    }
                });
                
                // Create sentiment alerts for top tickers
                Object.keys(tickerMentions)
                    .sort((a, b) => tickerMentions[b].count - tickerMentions[a].count)
                    .slice(0, 5)
                    .forEach(ticker => {
                        const data = tickerMentions[ticker];
                        
                        liveAlerts.push({
                            id: `sentiment_${ticker}_${Date.now()}`,
                            source: 'Social Sentiment',
                            title: `📊 ${ticker} Trending: ${data.count} mentions`,
                            content: `High social volume across ${data.sources.size} sources: ${Array.from(data.sources).join(', ')}. Monitor for volatility.`,
                            tickers: [ticker],
                            mentions: data.count,
                            type: 'market_sentiment',
                            timestamp: new Date(),
                            priority: data.count >= 5 ? 'high' : 'medium'
                        });
                    });
                    
            } catch (error) {
                console.error('Market sentiment error:', error);
            }
        }

        // HELPER FUNCTIONS
        function extractTickers(text) {
            if (!text) return [];
            const tickerRegex = /\b([A-Z]{1,5})\b/g;
            const tickers = [];
            let match;
            
            while ((match = tickerRegex.exec(text)) !== null) {
                const ticker = match[1];
                if (ticker.length >= 1 && ticker.length <= 5 && !['THE', 'AND', 'FOR', 'ARE', 'BUT', 'NOT', 'YOU', 'ALL', 'CAN', 'HER', 'WAS', 'ONE', 'OUR', 'HAD', 'BY', 'UP', 'DO', 'NO', 'IF', 'IS', 'TO', 'OF', 'IN', 'IT', 'ON', 'BE', 'AT', 'AS', 'OR', 'AN', 'WE', 'SO', 'MY', 'ME', 'GO', 'HE', 'AM', 'US', 'WHO', 'NOW', 'GET', 'HOW', 'NEW', 'OLD', 'SEE', 'TWO', 'WAY', 'ITS', 'OWN', 'OUT', 'DAY', 'USE', 'MAN', 'SAY', 'SHE', 'MAY', 'ADD', 'ILL', 'BAD', 'BIG', 'BOY', 'DID', 'END', 'FEW', 'GOT', 'HIM', 'HIS', 'HOT', 'LET', 'LOT', 'OFF', 'PUT', 'RUN', 'SET', 'TOP', 'TRY', 'WIN', 'YES', 'YET'].includes(ticker)) {
                    tickers.push(ticker);
                }
            }
            
            return [...new Set(tickers)];
        }

        function isTradeRelevant(text) {
            if (!text) return false;
            const tradingKeywords = ['options', 'calls', 'puts', 'trading', 'bull', 'bear', 'earnings', 'yolo', 'moon', 'rocket', 'dd', 'gain', 'loss'];
            const lowerText = text.toLowerCase();
            return tradingKeywords.some(keyword => lowerText.includes(keyword));
        }

        function updateFeedStatus(message) {
            const statusElement = document.getElementById('feedStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        // DISPLAY FUNCTIONS
        function displayLiveAlerts() {
            const alertsContainer = document.getElementById('liveAlerts');
            if (!alertsContainer) return;
            
            const uniqueAlerts = liveAlerts.filter((alert, index, self) => 
                index === self.findIndex(a => a.id === alert.id)
            );
            
            const sortedAlerts = uniqueAlerts
                .sort((a, b) => {
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    const aPriority = priorityOrder[a.priority] || 1;
                    const bPriority = priorityOrder[b.priority] || 1;
                    
                    if (aPriority !== bPriority) return bPriority - aPriority;
                    return new Date(b.timestamp) - new Date(a.timestamp);
                })
                .slice(0, 30);
            
            const alertsHTML = sortedAlerts.map(alert => {
                const timeAgo = getTimeAgo(alert.timestamp);
                const alertClass = getAlertClass(alert.type);
                const sourceColor = getSourceColor(alert.type);
                
                return `
                    <div class="alert-item ${alertClass}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                            <div style="font-weight: 700; color: ${sourceColor};">
                                ${getAlertIcon(alert.type)} ${alert.source}
                                ${alert.tickers && alert.tickers.length > 0 ? `• ${alert.tickers.slice(0, 3).join(', ')}` : ''}
                            </div>
                            <div style="font-size: 0.7rem; color: #6b7280;">
                                ${timeAgo}
                            </div>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">
                            ${alert.title}
                        </div>
                        <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.75rem;">
                            ${alert.content}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 0.8rem; color: #6b7280;">
                                ${getAlertStats(alert)}
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                ${alert.url ? `<button class="btn btn-small" onclick="window.open('${alert.url}', '_blank')">View</button>` : ''}
                                ${alert.tickers && alert.tickers.length > 0 ? `<button class="btn btn-small" onclick="askRoloAbout('${alert.tickers[0]}')" style="background: #7c3aed;">Ask Rolo</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            alertsContainer.innerHTML = alertsHTML || '<div style="text-align: center; padding: 2rem; color: #6b7280;">Loading live alerts...</div>';
        }

        function getAlertClass(type) {
            switch (type) {
                case 'alpaca_account': return 'alert-success';
                case 'reddit_feed': return 'alert-info';
                case 'financial_news': return 'alert-warning';
                case 'earnings': return 'alert-warning';
                case 'market_sentiment': return 'alert-info';
                default: return 'alert-info';
            }
        }

        function getSourceColor(type) {
            switch (type) {
                case 'alpaca_account': return '#059669';
                case 'reddit_feed': return '#ff4500';
                case 'financial_news': return '#1d4ed8';
                case 'earnings': return '#ea580c';
                case 'market_sentiment': return '#7c3aed';
                default: return '#6b7280';
            }
        }

        function getAlertIcon(type) {
            switch (type) {
                case 'alpaca_account': return '🏦';
                case 'reddit_feed': return '🟠';
                case 'financial_news': return '📰';
                case 'earnings': return '📅';
                case 'market_sentiment': return '📊';
                default: return '🔔';
            }
        }

        function getAlertStats(alert) {
            switch (alert.type) {
                case 'alpaca_account': return '🏦 Your Account';
                case 'reddit_feed': return `🟠 ↗️ ${alert.score} • 💬 ${alert.comments}`;
                case 'financial_news': return `📰 ${alert.sentiment || 'News'}`;
                case 'earnings': return '📅 Earnings Alert';
                case 'market_sentiment': return `📊 ${alert.mentions} mentions`;
                default: return alert.type;
            }
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'now';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffHours < 24) return `${diffHours}h`;
            return `${diffDays}d`;
        }

        // REAL CLAUDE API MESSAGING
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            messages.push({
                id: messages.length + 1,
                type: 'user',
                text: message
            });
            
            input.value = '';
            isTyping = true;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '⏳';
            renderCurrentTab();
            
            try {
                const enhancedMessage = await enhanceMessageWithFullContext(message);
                
                const response = await fetch('/.netlify/functions/claude-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: enhancedMessage })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                messages.push({
                    id: messages.length + 1,
                    type: 'assistant',
                    text: data.response || 'No response received'
                });
                
            } catch (error) {
                console.error('Claude API Error:', error);
                
                messages.push({
                    id: messages.length + 1,
                    type: 'assistant',
                    text: `❌ **Claude AI Connection Failed**\n\n**Error**: ${error.message}\n\n**To fix this:**\n1. Ensure ANTHROPIC_API_KEY is set in Netlify environment variables\n2. Verify your API key is valid and has credits\n3. Check network connection\n\n**Alpaca, Discord sentiment and market data still available in other tabs.**`
                });
            }
            
            isTyping = false;
            sendBtn.disabled = false;
            sendBtn.innerHTML = '➤';
            renderCurrentTab();
            
            setTimeout(() => {
                const messagesDiv = document.querySelector('.messages');
                if (messagesDiv) {
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }
            }, 100);
        }

        // Enhanced context with Alpaca data
        async function enhanceMessageWithFullContext(message) {
            try {
                if (!marketData.vix) await loadMarketData();
                if (!discordSentiment.volume) await loadDiscordSentiment();
                if (!alpacaData) await loadAlpacaData();
                
                let alpacaContext = '';
                if (alpacaData && !alpacaData.error && alpacaData.account) {
                    alpacaContext = `\n\nYOUR ALPACA ACCOUNT:
- Buying Power: $${parseFloat(alpacaData.account.buying_power).toFixed(2)}
- Portfolio Value: $${parseFloat(alpacaData.account.portfolio_value).toFixed(2)}
- Cash: $${parseFloat(alpacaData.account.cash).toFixed(2)}
- Account Type: ${alpacaData.account.pattern_day_trader ? 'Pattern Day Trader' : 'Standard'}
- Environment: Paper Trading`;
                } else if (alpacaData?.error) {
                    alpacaContext = `\n\nALPACA STATUS: ${alpacaData.error}`;
                }
                
                const tickers = extractTickersFromMessage(message);
                let tickerContext = '';
                
                if (tickers.length > 0) {
                    const ticker = tickers[0];
                    const discordData = discordSentiment.tickers?.[ticker];
                    
                    if (discordData) {
                        tickerContext = `\n\nDISCORD SENTIMENT FOR ${ticker}:
- Overall: ${discordData.sentiment} (${discordData.bullishPercent}% bullish, ${discordData.bearishPercent}% bearish)
- Volume: ${discordData.volume} mentions in last 24h`;
                    }
                }
                
                // Add recent live alerts context
                const recentAlerts = liveAlerts.slice(0, 5);
                let alertsContext = '';
                if (recentAlerts.length > 0) {
                    alertsContext = `\n\nRECENT LIVE ALERTS:
${recentAlerts.map(alert => `- ${alert.source}: ${alert.title}`).join('\n')}`;
                }
                
                const fullContext = `
CURRENT MARKET CONDITIONS:
- VIX: ${marketData.vix?.price || 'N/A'} (${getVIXSentiment(marketData.vix?.price)})
- S&P 500: ${marketData.sp500?.price || 'N/A'} (${marketData.sp500?.change || 'N/A'}%)
- Market Sentiment: ${getMarketSentiment()}

DISCORD TRADING SENTIMENT:
- Overall Discord Sentiment: ${discordSentiment.overall || 'N/A'}
- Total Volume: ${discordSentiment.volume || 0} messages analyzed${tickerContext}${alpacaContext}${alertsContext}

Original Question: ${message}

Provide specific options strategies considering market conditions, social sentiment, live alerts, AND the user's actual Alpaca account data if available. Tailor position sizes to their buying power and account type.`;
                
                return fullContext;
            } catch (error) {
                return message;
            }
        }

        function extractTickersFromMessage(message) {
            return extractTickers(message);
        }

        function getVIXSentiment(vix) {
            if (!vix) return 'Unknown';
            const vixValue = parseFloat(vix);
            if (vixValue < 15) return 'Extreme Greed';
            if (vixValue < 20) return 'Greed';
            if (vixValue < 25) return 'Neutral';
            if (vixValue < 30) return 'Fear';
            return 'Extreme Fear';
        }

        function getMarketSentiment() {
            if (!marketData.sp500 || !marketData.vix) return 'Unknown';
            
            const spChange = parseFloat(marketData.sp500.changePercent);
            const vixLevel = parseFloat(marketData.vix.price);
            
            if (spChange > 1 && vixLevel < 20) return 'Strong Bull Market';
            if (spChange > 0 && vixLevel < 25) return 'Bullish';
            if (spChange < -1 || vixLevel > 30) return 'Bearish';
            return 'Neutral';
        }

        // TICKER ANALYSIS
        async function analyzeTicker() {
            const input = document.getElementById('tickerInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const symbol = input.value.trim().toUpperCase();
            
            if (!symbol) return;
            
            ticker = symbol;
            
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '⏳ Loading...';
            analyzeBtn.disabled = true;
            
            try {
                const stockResult = await fetchRealStockData(symbol);
                
                if (!marketData.vix) await loadMarketData();
                const discordData = await loadDiscordSentiment(symbol);
                const tickerSentiment = discordData.tickers?.[symbol];
                
                let alpacaContext = '';
                if (alpacaData && !alpacaData.error && alpacaData.account) {
                    alpacaContext = `Account Context: $${parseFloat(alpacaData.account.buying_power).toFixed(2)} buying power available`;
                }
                
                const analysisPrompt = `Analyze ${symbol} for options trading:

STOCK DATA (${stockResult.source || 'live'}):
- Price: $${stockResult.price}
- Change: ${stockResult.change} (${stockResult.changePercent}%)
- Volume: ${stockResult.volume}M

MARKET CONDITIONS:
- VIX: ${marketData.vix?.price || 'N/A'}
- S&P 500: ${marketData.sp500?.changePercent || 'N/A'}% today

${tickerSentiment ? `DISCORD SENTIMENT:
- Sentiment: ${tickerSentiment.sentiment} (${tickerSentiment.bullishPercent}% bullish)
- Volume: ${tickerSentiment.volume} mentions` : 'DISCORD SENTIMENT: Limited chatter'}

${alpacaContext}

Provide specific options strategies with exact strikes, entry/exit points, and position sizing.`;
                
                const analysisResponse = await fetch('/.netlify/functions/claude-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: analysisPrompt })
                });
                
                if (analysisResponse.ok) {
                    const analysisData = await analysisResponse.json();
                    window.currentAnalysis = {
                        ticker: symbol,
                        aiResponse: analysisData.response,
                        stockData: stockResult,
                        timestamp: new Date()
                    };
                } else {
                    window.currentAnalysis = {
                        ticker: symbol,
                        aiResponse: `${symbol} analysis shows ${stockResult.change >= 0 ? 'bullish' : 'bearish'} momentum from ${stockResult.source}. Consider ${stockResult.change >= 0 ? 'call strategies' : 'put strategies'}.`,
                        stockData: stockResult,
                        timestamp: new Date()
                    };
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                window.currentAnalysis = {
                    ticker: symbol,
                    aiResponse: `❌ Unable to analyze ${symbol}: ${error.message}`,
                    stockData: null,
                    timestamp: new Date()
                };
            } finally {
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
                renderCurrentTab();
            }
        }

        async function quickAnalyze(symbol) {
            document.getElementById('tickerInput').value = symbol;
            await analyzeTicker();
        }

        function askRoloAbout(ticker) {
            switchTab('chat');
            setTimeout(() => {
                const input = document.getElementById('messageInput');
                if (input) {
                    input.value = `${ticker} options strategy with my account context and current market conditions`;
                    sendMessage();
                }
            }, 300);
        }

        // TAB SWITCHING
        function switchTab(tab) {
            if (currentTab === tab) return;
            
            const content = document.getElementById('content');
            const inputSection = document.getElementById('inputSection');
            
            if (tab === 'chat') {
                inputSection.style.display = 'block';
                content.style.paddingBottom = '8rem';
            } else {
                inputSection.style.display = 'none';
                content.style.paddingBottom = '5rem';
            }
            
            content.classList.add('fade-out');
            
            setTimeout(() => {
                currentTab = tab;
                
                document.querySelectorAll('.tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                const activeTab = document.getElementById(tab + '-tab');
                if (activeTab) {
                    activeTab.classList.add('active');
                }
                
                renderCurrentTab();
                content.classList.remove('fade-out');
                
                if (tab === 'chat') {
                    setTimeout(() => {
                        const messageInput = document.getElementById('messageInput');
                        if (messageInput) {
                            messageInput.focus();
                        }
                    }, 350);
                }
                
                if (tab === 'alerts') {
                    loadComprehensiveFeeds();
                }
            }, 150);
        }

        function goHome() {
            switchTab('chat');
        }

        // RENDER FUNCTIONS
        function renderCurrentTab() {
            const content = document.getElementById('content');
            let tabContent = '';
            
            switch(currentTab) {
                case 'chat':
                    tabContent = renderChat();
                    break;
                case 'ticker':
                    tabContent = renderTicker();
                    break;
                case 'analysis':
                    tabContent = renderAnalysis();
                    break;
                case 'plays':
                    tabContent = renderPlays();
                    break;
                case 'alerts':
                    tabContent = renderAlerts();
                    break;
            }
            
            content.innerHTML = `<div class="page-content">${tabContent}</div>`;
            
            if (currentTab === 'chat') {
                setTimeout(() => {
                    const messagesDiv = document.querySelector('.messages');
                    if (messagesDiv) {
                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    }
                }, 100);
            }
        }

        function renderChat() {
            return `
                <div class="scrollable-content">
                    <div class="card">
                        <div class="options-banner">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 1.25rem;">🤖</span>
                                <strong>Real Claude AI + Alpaca + Live Market Data</strong>
                            </div>
                            <div style="font-size: 0.8rem;">
                                Professional options analysis • Live account data • Market + social sentiment • Real-time alerts
                            </div>
                        </div>
                        
                        <div class="messages">
                            ${messages.map(msg => `
                                <div class="message ${msg.type}">
                                    <div class="message-content">${msg.text}</div>
                                    ${msg.type === 'assistant' ? '<div class="message-meta">🤖 Claude AI • Account + Market + Social + Alerts Analysis</div>' : ''}
                                </div>
                            `).join('')}
                            ${isTyping ? '<div class="message assistant"><div class="message-content">🤖 Claude is analyzing with your account + market + Discord + alerts data...</div></div>' : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTicker() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>🔍 Live Stock + Options Analysis</h3>
                    <p style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">
                        Real-time data from Alpaca & Alpha Vantage with sentiment analysis
                    </p>
                    
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="input" 
                            id="tickerInput"
                            placeholder="Enter ticker (AAPL, TSLA, SPY...)"
                            onkeypress="if(event.key==='Enter') analyzeTicker()"
                            value="${ticker}"
                        />
                        <button class="btn" onclick="analyzeTicker()" id="analyzeBtn">
                            🔍 Analyze
                        </button>
                    </div>
                    
                    ${stockData[ticker]?.error ? `
                        <div style="background: #fee2e2; padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid #fecaca; color: #dc2626;">
                            <strong>⚠️ Error:</strong> ${stockData[ticker].error}
                        </div>
                    ` : ''}
                </div>
                
                ${ticker && stockData[ticker] && !stockData[ticker].error ? `
                    <div class="card">
                        <h4 style="margin-bottom: 1rem;">${ticker} - Live Data (${stockData[ticker].source || 'unknown'}) 🟢</h4>
                        
                        <div class="stock-grid">
                            <div class="stat">
                                <div class="stat-label">Price</div>
                                <div class="stat-value price-positive">$${stockData[ticker].price}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Change</div>
                                <div class="stat-value ${stockData[ticker].change >= 0 ? 'price-positive' : 'price-negative'}">
                                    ${stockData[ticker].change >= 0 ? '+' : ''}${stockData[ticker].change} (${stockData[ticker].changePercent}%)
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Volume</div>
                                <div class="stat-value">${stockData[ticker].volume}M</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Source</div>
                                <div class="stat-value">${stockData[ticker].source === 'alpaca' ? 'Alpaca 🏦' : 'Alpha Vantage 📊'}</div>
                            </div>
                        </div>
                        
                        ${window.currentAnalysis && window.currentAnalysis.ticker === ticker ? `
                            <div style="background: #faf5ff; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; border-left: 4px solid #7c3aed;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 700; color: #7c3aed;">
                                    <span>🤖</span>
                                    <span>Claude AI Analysis (Live Data + Account Context)</span>
                                </div>
                                <div style="background: white; padding: 0.75rem; border-radius: 0.5rem; font-size: 0.9rem; line-height: 1.4; white-space: pre-line;">
                                    ${window.currentAnalysis.aiResponse}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
                
                <div class="card">
                    <h4>📋 Popular Tickers</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                        ${['SPY', 'QQQ', 'AAPL', 'TSLA', 'NVDA', 'MSFT', 'AMZN', 'GOOGL'].map(symbol => `
                            <button 
                                class="btn btn-small" 
                                onclick="quickAnalyze('${symbol}')"
                                style="background: #f3f4f6; color: #374141; border: 1px solid #d1d5db;"
                            >
                                ${symbol}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderAnalysis() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>📊 Professional Analysis</h3>
                    
                    ${window.currentAnalysis ? `
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 0.75rem;">${window.currentAnalysis.ticker} - Claude AI Analysis</h4>
                            <div style="background: white; padding: 1rem; border-radius: 0.5rem; line-height: 1.4; white-space: pre-line;">
                                ${window.currentAnalysis.aiResponse}
                            </div>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 3rem 1rem; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                            <h4 style="margin-bottom: 0.5rem;">No Analysis Available</h4>
                            <p style="margin-bottom: 1.5rem;">Analyze a stock to see Claude's professional analysis with live data + account context.</p>
                            <button class="btn" onclick="switchTab('ticker')">🔍 Analyze Stock</button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderPlays() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>🧠 AI Options Strategies</h3>
                    
                    <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
                        <div style="font-weight: 700; color: #0ea5e9; margin-bottom: 0.5rem;">🤖 Claude AI + Live Data Integration</div>
                        <div style="font-size: 0.9rem; color: #0c4a6e;">
                            Get personalized options strategies from Claude AI enhanced with real-time Alpaca data, market conditions, Discord sentiment, and live alerts.
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 2rem 1rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🤖</div>
                        <h4 style="margin-bottom: 1rem;">Smart Strategies with Live Data</h4>
                        <div style="display: grid; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <button class="btn" onclick="askClaude('Give me 3 options plays this week based on my account size, Discord sentiment, VIX levels, and live alerts')">
                                📈 Account-Based Plays
                            </button>
                            <button class="btn" onclick="askClaude('Contrarian options strategy: fade Discord hype with my buying power and current market conditions')" style="background: #dc2626;">
                                🔄 Contrarian Strategy
                            </button>
                            <button class="btn" onclick="askClaude('What tickers from live alerts have good options setups for my account size?')" style="background: #059669;">
                                🔔 Alert-Based Plays
                            </button>
                            <button class="btn" onclick="askClaude('Conservative income strategies using my Alpaca account with current VIX levels')" style="background: #7c3aed;">
                                💰 Income Generation
                            </button>
                        </div>
                        <button class="btn" onclick="switchTab('chat')" style="background: #22c55e;">
                            💬 Custom Strategy Request
                        </button>
                    </div>
                </div>
            `;
        }

        function renderAlerts() {
            return `
                <div class="card">
                    <button class="home-btn" onclick="goHome()">
                        <span>🏠</span>
                        <span>Back to Chat</span>
                    </button>
                    
                    <h3>🔔 Live Trading Intelligence Hub</h3>
                    <p style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">
                        Real-time market signals from Alpaca account, Reddit, financial news, earnings, and sentiment analysis
                    </p>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid #0ea5e9;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="font-weight: 700; color: #0ea5e9;">📡 Live Intelligence Status</div>
                            <button class="btn btn-small" onclick="loadComprehensiveFeeds()" style="background: #22c55e;">
                                🔄 Refresh All
                            </button>
                        </div>
                        <div style="font-size: 0.9rem; color: #0c4a6e;" id="feedStatus">
                            Loading comprehensive market intelligence...
                        </div>
                    </div>
                    
                    <div id="liveAlerts">
                        <!-- Live alerts will load here -->
                    </div>
                    
                    <div class="card" style="margin-top: 1rem;">
                        <h4>📡 Live Feed Sources</h4>
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.85rem;">
                                <div>
                                    <strong>🏦 Alpaca Integration:</strong><br/>
                                    • Your account balance<br/>
                                    • Buying power updates<br/>
                                    • Portfolio status<br/>
                                    <br/>
                                    <strong>🟠 Reddit Sources:</strong><br/>
                                    • r/wallstreetbets<br/>
                                    • r/options<br/>
                                    • r/investing<br/>
                                    • r/thetagang
                                </div>
                                <div>
                                    <strong>📰 Market Data:</strong><br/>
                                    • Alpha Vantage News<br/>
                                    • Earnings Calendar<br/>
                                    • Social Sentiment Analysis<br/>
                                    <br/>
                                    <strong>📊 Analysis:</strong><br/>
                                    • Trending tickers<br/>
                                    • Options opportunities<br/>
                                    • Market conditions<br/>
                                    • Account-based alerts
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions
        function askClaude(question) {
            switchTab('chat');
            setTimeout(() => {
                const input = document.getElementById('messageInput');
                if (input) {
                    input.value = question;
                    sendMessage();
                }
            }, 300);
        }

        // Utility functions
        function setIsLoadingStock(loading) {
            // This would update loading state in React, but we're using vanilla JS
            console.log('Loading stock:', loading);
        }

        function setApiError(error) {
            // This would set error state in React, but we're using vanilla JS
            if (error) console.error('API Error:', error);
        }

        function setStockData(updateFn) {
            if (typeof updateFn === 'function') {
                stockData = updateFn(stockData);
            } else {
                stockData = updateFn;
            }
        }
    </script>
</body>
</html>
