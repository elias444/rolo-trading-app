<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolo AI Trading</title>
    <style>
        body { 
            margin: 0; 
            font-family: system-ui, sans-serif; 
        }
        #root { 
            width: 100vw; 
            height: 100vh; 
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            flex-direction: column;
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <div>üöÄ Loading Rolo AI Trading...</div>
        </div>
    </div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const RoloApp = () => {
          const [currentTab, setCurrentTab] = React.useState('chat');
          const [ticker, setTicker] = React.useState('');
          const [messages, setMessages] = React.useState([
            {
              id: 1,
              type: 'assistant',
              content: "Hello! I'm Rolo, your AI-powered trading assistant. I'm connected to live market data and ready to help you analyze stocks, find options plays, and learn your trading style. What would you like to explore today?",
              timestamp: new Date()
            }
          ]);
          const [inputMessage, setInputMessage] = React.useState('');
          const [isTyping, setIsTyping] = React.useState(false);
          const [apiConnected, setApiConnected] = React.useState(false);
          const [stockData, setStockData] = React.useState({});
          const [isLoadingStock, setIsLoadingStock] = React.useState(false);
          const [apiError, setApiError] = React.useState(null);

          React.useEffect(() => {
            setTimeout(() => setApiConnected(true), 2000);
          }, []);

          const handleSendMessage = async () => {
            if (!inputMessage.trim()) return;

            const newMessage = {
              id: messages.length + 1,
              type: 'user',
              content: inputMessage,
              timestamp: new Date()
            };

            setMessages([...messages, newMessage]);
            const userQuery = inputMessage;
            setInputMessage('');
            setIsTyping(true);

            try {
              const response = await fetch('/.netlify/functions/claude-chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: userQuery })
              });

              const data = await response.json();
              const aiResponse = {
                id: messages.length + 2,
                type: 'assistant',
                content: data.response || "I'm here to help with your trading questions!",
                timestamp: new Date()
              };

              setMessages(prev => [...prev, aiResponse]);
            } catch (error) {
              const errorMessage = {
                id: messages.length + 2,
                type: 'assistant',
                content: "I'm having trouble connecting right now, but I'm still here to help with trading advice!",
                timestamp: new Date()
              };
              setMessages(prev => [...prev, errorMessage]);
            } finally {
              setIsTyping(false);
            }
          };

          const handleTickerSubmit = async () => {
            if (!ticker.trim()) return;
            
            setIsLoadingStock(true);
            setApiError(null);
            
            try {
              const response = await fetch(`/.netlify/functions/stock-data?symbol=${ticker.toUpperCase()}`);
              const data = await response.json();
              
              if (data.error && !data.fallback) {
                throw new Error(data.error);
              }
              
              setStockData(prev => ({
                ...prev,
                [ticker.toUpperCase()]: data
              }));
              
            } catch (error) {
              setApiError('Unable to fetch live data - showing demo data');
              setStockData(prev => ({
                ...prev,
                [ticker.toUpperCase()]: {
                  price: (Math.random() * 100 + 200).toFixed(2),
                  change: (Math.random() * 10 - 5).toFixed(2),
                  changePercent: (Math.random() * 4 - 2).toFixed(2),
                  volume: (Math.random() * 50 + 10).toFixed(1)
                }
              }));
            } finally {
              setIsLoadingStock(false);
            }
          };

          const renderChat = () => (
            <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>
              <div style={{ 
                padding: '12px', 
                fontSize: '14px', 
                backgroundColor: apiConnected ? '#dcfce7' : '#fef3c7', 
                color: apiConnected ? '#166534' : '#92400e' 
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{ 
                    width: '8px', 
                    height: '8px', 
                    backgroundColor: apiConnected ? '#22c55e' : '#eab308', 
                    borderRadius: '50%' 
                  }}></div>
                  <span>{apiConnected ? '‚úÖ Rolo Online: Real APIs Active' : 'üîÑ Rolo starting up...'}</span>
                </div>
              </div>

              <div style={{ flex: 1, overflowY: 'auto', padding: '16px' }}>
                {messages.map((message) => (
                  <div key={message.id} style={{ 
                    display: 'flex', 
                    justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start', 
                    marginBottom: '16px' 
                  }}>
                    <div style={{
                      maxWidth: '85%',
                      padding: '12px',
                      borderRadius: '8px',
                      backgroundColor: message.type === 'user' ? '#7c3aed' : '#f3f4f6',
                      color: message.type === 'user' ? 'white' : '#1f2937',
                      fontSize: '16px',
                      lineHeight: '1.4'
                    }}>
                      <div style={{ whiteSpace: 'pre-line' }}>{message.content}</div>
                      {message.type === 'assistant' && (
                        <div style={{ 
                          display: 'flex', 
                          alignItems: 'center', 
                          marginTop: '8px', 
                          fontSize: '12px', 
                          color: '#6b7280' 
                        }}>
                          <span>üß† Rolo AI ‚Ä¢ Live Analysis</span>
                        </div>
                      )}
                    </div>
                  </div>
                ))}
                
                {isTyping && (
                  <div style={{ display: 'flex', justifyContent: 'flex-start', marginBottom: '16px' }}>
                    <div style={{ backgroundColor: '#f3f4f6', padding: '12px', borderRadius: '8px' }}>
                      <span style={{ fontSize: '14px', color: '#6b7280' }}>üß† Rolo is analyzing...</span>
                    </div>
                  </div>
                )}
              </div>
              
              <div style={{ padding: '16px', borderTop: '1px solid #e5e7eb', backgroundColor: 'white' }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px' }}>
                  <span style={{ fontSize: '14px', color: '#6b7280' }}>üé§ Rolo AI</span>
                  <span style={{ fontSize: '12px', color: '#6b7280' }}>üß† Live: {apiConnected ? 'ACTIVE' : 'CONNECTING'}</span>
                </div>
                <div style={{ display: 'flex' }}>
                  <input
                    type="text"
                    value={inputMessage}
                    onChange={(e) => setInputMessage(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                    placeholder="Ask Rolo about stocks..."
                    style={{
                      flex: 1,
                      padding: '12px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px 0 0 8px',
                      outline: 'none',
                      fontSize: '16px'
                    }}
                  />
                  <button
                    onClick={handleSendMessage}
                    disabled={isTyping}
                    style={{
                      backgroundColor: isTyping ? '#9ca3af' : '#7c3aed',
                      color: 'white',
                      padding: '12px 16px',
                      border: 'none',
                      borderRadius: '0 8px 8px 0',
                      cursor: isTyping ? 'not-allowed' : 'pointer',
                      fontSize: '16px'
                    }}
                  >
                    {isTyping ? '‚è≥' : '‚û§'}
                  </button>
                </div>
              </div>
            </div>
          );

          const renderTicker = () => (
            <div style={{ padding: '16px', overflowY: 'auto' }}>
              <div style={{ backgroundColor: 'white', borderRadius: '8px', padding: '16px', marginBottom: '16px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                <h3 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '16px' }}>Real-Time Stock Analysis</h3>
                <div style={{ display: 'flex', gap: '8px' }}>
                  <input
                    type="text"
                    value={ticker}
                    onChange={(e) => setTicker(e.target.value.toUpperCase())}
                    onKeyPress={(e) => e.key === 'Enter' && handleTickerSubmit()}
                    placeholder="Enter ticker (AAPL, TSLA...)"
                    style={{
                      flex: 1,
                      padding: '12px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      outline: 'none',
                      fontSize: '16px'
                    }}
                  />
                  <button 
                    onClick={handleTickerSubmit}
                    disabled={isLoadingStock}
                    style={{
                      backgroundColor: isLoadingStock ? '#9ca3af' : '#7c3aed',
                      color: 'white',
                      padding: '12px 16px',
                      border: 'none',
                      borderRadius: '8px',
                      cursor: isLoadingStock ? 'not-allowed' : 'pointer',
                      fontSize: '18px'
                    }}
                  >
                    {isLoadingStock ? '‚è≥' : 'üîç'}
                  </button>
                </div>
                {apiError && (
                  <div style={{ marginTop: '10px', padding: '10px', backgroundColor: '#fee2e2', borderRadius: '6px', fontSize: '14px', color: '#dc2626' }}>
                    ‚ö†Ô∏è {apiError}
                  </div>
                )}
              </div>

              {ticker && stockData[ticker] && (
                <div style={{ backgroundColor: 'white', borderRadius: '8px', padding: '16px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                  <h4 style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '16px' }}>{ticker}</h4>
                  
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                    <div>
                      <p style={{ fontSize: '14px', color: '#6b7280', margin: '0 0 4px 0' }}>Price</p>
                      <p style={{ fontSize: '24px', fontWeight: 'bold', color: '#22c55e', margin: 0 }}>
                        ${stockData[ticker].price}
                      </p>
                    </div>
                    <div>
                      <p style={{ fontSize: '14px', color: '#6b7280', margin: '0 0 4px 0' }}>Change</p>
                      <p style={{ fontSize: '18px', fontWeight: 'bold', color: stockData[ticker].change >= 0 ? '#22c55e' : '#ef4444', margin: 0 }}>
                        {stockData[ticker].change >= 0 ? '+' : ''}{stockData[ticker].change} ({stockData[ticker].changePercent}%)
                      </p>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );

          return (
            <div style={{ 
              width: '100vw',
              height: '100vh', 
              display: 'flex', 
              flexDirection: 'column', 
              backgroundColor: '#f8fafc',
              fontFamily: 'system-ui, -apple-system, sans-serif',
              margin: 0,
              padding: 0,
              overflow: 'hidden'
            }}>
              <div style={{ 
                background: 'linear-gradient(to right, #7c3aed, #6366f1)', 
                color: 'white', 
                padding: '16px',
                boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <h1 style={{ fontSize: '20px', fontWeight: 'bold', margin: 0 }}>ü§ñ Rolo AI Trading</h1>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <div style={{ 
                      width: '12px', 
                      height: '12px', 
                      backgroundColor: apiConnected ? '#22c55e' : '#eab308', 
                      borderRadius: '50%' 
                    }}></div>
                    <span style={{ fontSize: '14px' }}>{apiConnected ? 'Live APIs' : 'Connecting'}</span>
                  </div>
                </div>
                <p style={{ color: '#c4b5fd', fontSize: '14px', margin: '4px 0 0 0' }}>Your AI Trading Assistant with Real APIs</p>
              </div>

              <div style={{ flex: 1, overflow: 'hidden' }}>
                {currentTab === 'chat' && renderChat()}
                {currentTab === 'ticker' && renderTicker()}
              </div>

              <div style={{ 
                backgroundColor: 'white', 
                borderTop: '1px solid #e5e7eb', 
                boxShadow: '0 -2px 4px rgba(0,0,0,0.1)',
                display: 'flex',
                alignItems: 'center'
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-around', padding: '8px', width: '100%' }}>
                  {[
                    { id: 'chat', icon: 'üí¨', label: 'Chat' },
                    { id: 'ticker', icon: 'üîç', label: 'Ticker' }
                  ].map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setCurrentTab(tab.id)}
                      style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        padding: '12px',
                        border: 'none',
                        borderRadius: '8px',
                        backgroundColor: currentTab === tab.id ? '#faf5ff' : 'transparent',
                        color: currentTab === tab.id ? '#7c3aed' : '#6b7280',
                        cursor: 'pointer',
                        fontSize: '12px',
                        minWidth: '80px'
                      }}
                    >
                      <span style={{ fontSize: '20px', marginBottom: '4px' }}>{tab.icon}</span>
                      <span>{tab.label}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          );
        };
        
        ReactDOM.render(React.createElement(RoloApp), document.getElementById('root'));
    </script>
</body>
</html>
