<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolo AI Trading - Complete</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #f8fafc; }
        .app { height: 100vh; display: flex; flex-direction: column; }
        .header { 
            background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%); 
            color: white; 
            padding: 1rem; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        .header h1 { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .header p { opacity: 0.9; font-size: 0.875rem; }
        .status-bar { 
            background: #dcfce7; 
            color: #166534; 
            padding: 0.5rem 1rem; 
            font-size: 0.875rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
        }
        .status-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; }
        .content { flex: 1; padding: 1rem; overflow-y: auto; }
        .card { 
            background: white; 
            padding: 1rem; 
            margin-bottom: 1rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .tabs { 
            display: flex; 
            background: white; 
            border-top: 1px solid #e5e7eb; 
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1); 
        }
        .tab { 
            flex: 1; 
            padding: 0.75rem; 
            text-align: center; 
            cursor: pointer; 
            border: none; 
            background: none; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 0.25rem;
            font-size: 0.75rem;
        }
        .tab.active { background: #faf5ff; color: #7c3aed; font-weight: bold; }
        .tab-icon { font-size: 1.25rem; }
        .input-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .input { 
            flex: 1; 
            padding: 0.75rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.5rem; 
            outline: none; 
        }
        .btn { 
            padding: 0.75rem 1rem; 
            background: #7c3aed; 
            color: white; 
            border: none; 
            border-radius: 0.5rem; 
            cursor: pointer; 
            font-weight: 500;
        }
        .btn:hover { background: #6d28d9; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-small { padding: 0.5rem 0.75rem; font-size: 0.875rem; }
        .btn-success { background: #22c55e; }
        .btn-success:hover { background: #16a34a; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        
        .messages { 
            height: 300px; 
            overflow-y: auto; 
            border: 1px solid #e5e7eb; 
            padding: 0.75rem; 
            margin-bottom: 1rem; 
            border-radius: 0.5rem; 
            background: #fafafa; 
        }
        .message { margin-bottom: 1rem; }
        .message.user { text-align: right; }
        .message-content { 
            display: inline-block; 
            max-width: 80%; 
            padding: 0.75rem; 
            border-radius: 0.5rem; 
            line-height: 1.4; 
            white-space: pre-line;
        }
        .message.user .message-content { background: #7c3aed; color: white; }
        .message.assistant .message-content { background: #f3f4f6; color: #1f2937; }
        .message-meta { font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem; }
        
        .stock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        .stat { text-align: center; padding: 0.75rem; background: #f8f9fa; border-radius: 0.5rem; }
        .stat-label { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem; }
        .stat-value { font-size: 1.25rem; font-weight: bold; }
        .price-positive { color: #22c55e; }
        .price-negative { color: #ef4444; }
        
        .analysis-section { 
            background: #faf5ff; 
            padding: 1rem; 
            border-radius: 0.5rem; 
            margin-top: 1rem; 
            border-left: 4px solid #7c3aed; 
        }
        .analysis-header { 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            margin-bottom: 0.5rem; 
            font-weight: bold; 
            color: #7c3aed; 
        }
        .confidence-score { 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #22c55e; 
        }
        
        .watchlist-section { margin-bottom: 1rem; }
        .watchlist-tabs { 
            display: flex; 
            gap: 0.5rem; 
            margin-bottom: 1rem; 
            flex-wrap: wrap; 
        }
        .watchlist-tab { 
            padding: 0.5rem 0.75rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.25rem; 
            background: #f9fafb; 
            cursor: pointer; 
            font-size: 0.875rem; 
            position: relative;
        }
        .watchlist-tab.active { border-color: #7c3aed; background: #faf5ff; color: #7c3aed; font-weight: bold; }
        .watchlist-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0.75rem; 
            border: 1px solid #e5e7eb; 
            border-radius: 0.5rem; 
            margin-bottom: 0.5rem; 
            background: #f9fafb; 
            cursor: pointer; 
            transition: all 0.2s;
        }
        .watchlist-item:hover { background: #f3f4f6; border-color: #d1d5db; }
        .watchlist-actions { display: flex; gap: 0.5rem; align-items: center; }
        .menu-btn { 
            background: none; 
            border: none; 
            color: #6b7280; 
            cursor: pointer; 
            padding: 0.25rem; 
            border-radius: 0.25rem; 
        }
        .menu-btn:hover { background: #f3f4f6; }
        
        .play-card { 
            border: 1px solid #e5e7eb; 
            border-radius: 0.5rem; 
            padding: 1rem; 
            margin-bottom: 1rem; 
            background: white; 
        }
        .play-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 0.75rem; 
        }
        .play-symbol { font-size: 1.125rem; font-weight: bold; }
        .play-type { 
            padding: 0.25rem 0.5rem; 
            border-radius: 0.25rem; 
            font-size: 0.75rem; 
            font-weight: bold; 
            margin-left: 0.5rem; 
        }
        .play-type.call { background: #dcfce7; color: #166534; }
        .play-type.put { background: #fee2e2; color: #dc2626; }
        .play-confidence { 
            text-align: right; 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #22c55e; 
        }
        .play-details { font-size: 0.875rem; color: #6b7280; }
        
        .alert-item { 
            padding: 0.75rem; 
            border-radius: 0.5rem; 
            margin-bottom: 0.75rem; 
            border-left: 4px solid; 
        }
        .alert-success { background: #dcfce7; border-color: #22c55e; }
        .alert-info { background: #faf5ff; border-color: #7c3aed; }
        .alert-warning { background: #fef3c7; border-color: #eab308; }
        .alert-title { font-weight: bold; margin-bottom: 0.25rem; }
        .alert-message { font-size: 0.875rem; margin-bottom: 0.25rem; }
        .alert-time { font-size: 0.75rem; color: #6b7280; }
        
        .empty-state { 
            text-align: center; 
            padding: 2rem; 
            color: #6b7280; 
        }
        .empty-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        
        .error-state {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #dc2626;
        }
        
        @media (max-width: 768px) {
            .stock-grid { grid-template-columns: 1fr; }
            .input-group { flex-direction: column; }
            .watchlist-tabs { flex-direction: column; }
            .play-header { flex-direction: column; gap: 0.5rem; }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('chat');
            const [message, setMessage] = useState('');
            const [messages, setMessages] = useState([
                { id: 1, type: 'assistant', text: "Hello! I'm Rolo, your AI-powered trading assistant. I'm connected to live market data and ready to help you analyze stocks, find options plays, and learn your trading style. What would you like to explore today?" }
            ]);
            const [ticker, setTicker] = useState('');
            const [stockData, setStockData] = useState({});
            const [analysisResults, setAnalysisResults] = useState({});
            const [isLoading, setIsLoading] = useState(false);
            const [isTyping, setIsTyping] = useState(false);
            const [apiConnected, setApiConnected] = useState(false);
            const [apiError, setApiError] = useState(null);
            
            // Watchlist management
            const [watchlists, setWatchlists] = useState({
                'Main Portfolio': ['SPY', 'QQQ', 'AAPL'],
                'Growth Stocks': ['TSLA', 'NVDA', 'AMZN'],
                'Tech': ['MSFT', 'GOOGL', 'META']
            });
            const [activeWatchlist, setActiveWatchlist] = useState('Main Portfolio');
            const [newWatchlistName, setNewWatchlistName] = useState('');
            const [showNewWatchlistInput, setShowNewWatchlistInput] = useState(false);
            const [newTicker, setNewTicker] = useState('');
            
            // Initialize and test API connection
            useEffect(() => {
                testApiConnection();
                loadWatchlistData();
            }, []);
            
            const testApiConnection = async () => {
                try {
                    const response = await fetch('/.netlify/functions/stock-data?symbol=SPY');
                    if (response.ok) {
                        setApiConnected(true);
                        setApiError(null);
                    } else {
                        throw new Error('API connection failed');
                    }
                } catch (error) {
                    console.error('API connection test failed:', error);
                    setApiConnected(false);
                    setApiError('API temporarily unavailable - using demo data');
                }
            };
            
            const loadWatchlistData = async () => {
                const allTickers = Object.values(watchlists).flat();
                const uniqueTickers = [...new Set(allTickers)];
                
                for (const symbol of uniqueTickers.slice(0, 8)) {
                    await fetchRealStockData(symbol, false);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            };
            
            const fetchRealStockData = async (symbol, showLoading = true) => {
                if (showLoading) setIsLoading(true);
                
                try {
                    const response = await fetch(`/.netlify/functions/stock-data?symbol=${symbol}`);
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error && !data.fallback) {
                        throw new Error(data.error);
                    }
                    
                    // If it's fallback data, show warning
                    if (data.fallback) {
                        setApiError('Using demo data - live API temporarily unavailable');
                        // Generate demo data
                        const demoData = generateDemoData(symbol);
                        setStockData(prev => ({ ...prev, [symbol]: demoData }));
                        const analysis = generateAnalysis(symbol, demoData);
                        setAnalysisResults(prev => ({ ...prev, [symbol]: analysis }));
                        return demoData;
                    }
                    
                    // Real API data
                    setApiError(null);
                    setStockData(prev => ({ ...prev, [symbol]: data }));
                    const analysis = generateAnalysis(symbol, data);
                    setAnalysisResults(prev => ({ ...prev, [symbol]: analysis }));
                    return data;
                    
                } catch (error) {
                    console.error('Error fetching stock data:', error);
                    setApiError('Live data unavailable - using demo mode');
                    
                    // Fallback to demo data
                    const demoData = generateDemoData(symbol);
                    setStockData(prev => ({ ...prev, [symbol]: demoData }));
                    const analysis = generateAnalysis(symbol, demoData);
                    setAnalysisResults(prev => ({ ...prev, [symbol]: analysis }));
                    return demoData;
                } finally {
                    if (showLoading) setIsLoading(false);
                }
            };
            
            const generateDemoData = (symbol) => ({
                price: (Math.random() * 200 + 50).toFixed(2),
                change: (Math.random() * 20 - 10).toFixed(2),
                changePercent: (Math.random() * 8 - 4).toFixed(2),
                volume: (Math.random() * 100 + 10).toFixed(1),
                high: (Math.random() * 220 + 60).toFixed(2),
                low: (Math.random() * 180 + 40).toFixed(2),
                open: (Math.random() * 200 + 50).toFixed(2),
                prevClose: (Math.random() * 200 + 50).toFixed(2),
                isLive: false
            });
            
            const sendToClaudeAPI = async (message) => {
                try {
                    const response = await fetch('/.netlify/functions/claude-chat', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ message })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    return data.response;
                    
                } catch (error) {
                    console.error('Claude API error:', error);
                    return `🤖 Rolo here! I'm ready to help with trading analysis, but I'm having a brief connection issue. Try asking me about:\n\n• Any stock ticker analysis\n• Options strategies\n• Risk management tips\n• Market trends\n\nWhat's on your trading radar?`;
                }
            };
            
            const generateAnalysis = (symbol, data) => {
                const priceChange = parseFloat(data.change);
                const volume = parseFloat(data.volume);
                const isBullish = priceChange > 0;
                const confidence = Math.min(95, Math.max(65, 75 + (Math.abs(priceChange) * 3) + (volume > 50 ? 10 : 0)));
                
                return {
                    confidence: Math.floor(confidence),
                    recommendation: isBullish ? 'BULLISH' : 'BEARISH',
                    reasoning: `${symbol} showing ${isBullish ? 'positive' : 'negative'} momentum with ${data.changePercent}% change. Volume: ${data.volume}M. ${data.isLive ? 'Live data shows' : 'Analysis suggests'} ${isBullish ? 'continued strength' : 'potential weakness'}.`,
                    technicalScore: Math.floor(60 + Math.random() * 35),
                    sentimentScore: Math.floor(55 + Math.random() * 40),
                    riskLevel: confidence > 80 ? 'Low' : confidence > 70 ? 'Medium' : 'High',
                    priceTargets: {
                        support: (parseFloat(data.price) * 0.92).toFixed(2),
                        resistance: (parseFloat(data.price) * 1.08).toFixed(2)
                    }
                };
            };
            
            const sendMessage = async () => {
                if (!message.trim()) return;
                
                const userMessage = { id: Date.now(), type: 'user', text: message };
                setMessages(prev => [...prev, userMessage]);
                const userQuery = message;
                setMessage('');
                setIsTyping(true);
                
                try {
                    const aiResponse = await sendToClaudeAPI(userQuery);
                    
                    const responseMessage = {
                        id: Date.now() + 1,
                        type: 'assistant',
                        text: aiResponse
                    };
                    
                    setMessages(prev => [...prev, responseMessage]);
                } catch (error) {
                    const errorMessage = {
                        id: Date.now() + 1,
                        type: 'assistant',
                        text: "I'm here to help with trading analysis! Ask me about any stock or trading concept."
                    };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsTyping(false);
                }
            };
            
            const analyzeStock = async () => {
                if (!ticker.trim()) return;
                
                const symbol = ticker.toUpperCase().trim();
                await fetchRealStockData(symbol, true);
            };
            
            // Watchlist functions
            const createNewWatchlist = () => {
                if (newWatchlistName.trim() && !watchlists[newWatchlistName]) {
                    setWatchlists(prev => ({
                        ...prev,
                        [newWatchlistName]: []
                    }));
                    setActiveWatchlist(newWatchlistName);
                    setNewWatchlistName('');
                    setShowNewWatchlistInput(false);
                }
            };
            
            const deleteWatchlist = (name) => {
                if (Object.keys(watchlists).length > 1) {
                    const newWatchlists = { ...watchlists };
                    delete newWatchlists[name];
                    setWatchlists(newWatchlists);
                    if (activeWatchlist === name) {
                        setActiveWatchlist(Object.keys(newWatchlists)[0]);
                    }
                }
            };
            
            const addToWatchlist = async () => {
                if (newTicker.trim()) {
                    const symbol = newTicker.toUpperCase();
                    if (!watchlists[activeWatchlist].includes(symbol)) {
                        setWatchlists(prev => ({
                            ...prev,
                            [activeWatchlist]: [...prev[activeWatchlist], symbol]
                        }));
                        await fetchRealStockData(symbol, false);
                    }
                    setNewTicker('');
                }
            };
            
            const removeFromWatchlist = (symbol) => {
                setWatchlists(prev => ({
                    ...prev,
                    [activeWatchlist]: prev[activeWatchlist].filter(s => s !== symbol)
                }));
            };
            
            const getHighConfidencePlays = () => {
                const plays = [];
                Object.entries(analysisResults).forEach(([symbol, analysis]) => {
                    if (analysis.confidence >= 75 && stockData[symbol]) {
                        const stock = stockData[symbol];
                        plays.push({
                            symbol,
                            type: analysis.recommendation === 'BULLISH' ? 'Call' : 'Put',
                            strike: Math.floor(parseFloat(stock.price) * (analysis.recommendation === 'BULLISH' ? 1.03 : 0.97)),
                            dte: Math.floor(Math.random() * 7) + 1,
                            confidence: analysis.confidence,
                            reason: analysis.reasoning.slice(0, 80) + '...',
                            currentPrice: stock.price,
                            changePercent: stock.changePercent
                        });
                    }
                });
                
                return plays.slice(0, 6);
            };
            
            const getRecentAlerts = () => {
                const alerts = [];
                
                // System status alert
                alerts.push({
                    type: apiConnected ? 'success' : 'warning',
                    title: apiConnected ? '✅ Live APIs Connected' : '⚠️ Demo Mode Active',
                    message: apiConnected ? 'Real-time data from Alpha Vantage + Claude AI' : 'Live APIs temporarily unavailable - using demo data',
                    time: 'Just now'
                });
                
                // Generate alerts based on analysis
                Object.entries(analysisResults).forEach(([symbol, analysis]) => {
                    if (analysis.confidence >= 80) {
                        alerts.push({
                            type: 'success',
                            title: '🎯 High Confidence Signal',
                            message: `${symbol} ${analysis.recommendation} signal detected - ${analysis.confidence}% confidence`,
                            time: '5 minutes ago'
                        });
                    }
                    
                    if (stockData[symbol] && Math.abs(parseFloat(stockData[symbol].changePercent)) > 3) {
                        alerts.push({
                            type: 'info',
                            title: '📊 Unusual Movement',
                            message: `${symbol} moving ${stockData[symbol].changePercent >= 0 ? 'up' : 'down'} ${Math.abs(stockData[symbol].changePercent)}% today`,
                            time: '10 minutes ago'
                        });
                    }
                });
                
                return alerts.slice(0, 5);
            };
            
            // Render functions
            const renderChat = () => (
                <div className="card">
                    <h3>💬 Chat with Rolo AI</h3>
                    
                    {/* API Status */}
                    {apiError && (
                        <div className="error-state">
                            ⚠️ {apiError}
                        </div>
                    )}
                    
                    <div className="messages">
                        {messages.map(msg => (
                            <div key={msg.id} className={`message ${msg.type}`}>
                                <div className="message-content">{msg.text}</div>
                                {msg.type === 'assistant' && (
                                    <div className="message-meta">
                                        🧠 Rolo AI • {apiConnected ? 'Live Analysis' : 'Demo Mode'}
                                    </div>
                                )}
                            </div>
                        ))}
                        {isTyping && (
                            <div className="message assistant">
                                <div className="message-content">🤔 Rolo is analyzing...</div>
                            </div>
                        )}
                    </div>
                    <div className="input-group">
                        <input 
                            className="input"
                            value={message}
                            onChange={(e) => setMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                            placeholder="Ask Rolo about any stock, strategy, or market trend..."
                            disabled={isTyping}
                        />
                        <button className="btn" onClick={sendMessage} disabled={isTyping}>
                            {isTyping ? '⏳' : '➤'}
                        </button>
                    </div>
                </div>
            );
            
            const renderTicker = () => (
                <div>
                    <div className="card">
                        <h3>🔍 Universal Stock Analysis</h3>
                        <p style={{ marginBottom: '1rem', color: '#6b7280' }}>
                            Analyze ANY stock ticker with {apiConnected ? 'live Alpha Vantage data' : 'demo data'}
                        </p>
                        
                        {apiError && (
                            <div className="error-state">
                                ⚠️ {apiError}
                            </div>
                        )}
                        
                        <div className="input-group">
                            <input 
                                className="input"
                                value={ticker}
                                onChange={(e) => setTicker(e.target.value.toUpperCase())}
                                onKeyPress={(e) => e.key === 'Enter' && analyzeStock()}
                                placeholder="Enter ANY ticker (AAPL, TSLA, BRK.A, AMZN, etc.)"
                                disabled={isLoading}
                            />
                            <button className="btn" onClick={analyzeStock} disabled={isLoading}>
                                {isLoading ? '⏳ Analyzing...' : '🔍 Analyze'}
                            </button>
                        </div>
                    </div>
                    
                    {ticker && stockData[ticker] && (
                        <div className="card">
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                                <h4 style={{ fontSize: '1.25rem' }}>{ticker}</h4>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                    <div className="status-dot" style={{ backgroundColor: stockData[ticker].isLive ? '#22c55e' : '#eab308' }}></div>
                                    <span style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                        {stockData[ticker].isLive ? 'Live Data' : 'Demo Data'}
                                    </span>
                                </div>
                            </div>
                            
                            <div className="stock-grid">
                                <div className="stat">
                                    <div className="stat-label">Price</div>
                                    <div className="stat-value price-positive">${stockData[ticker].price}</div>
                                </div>
                                <div className="stat">
                                    <div className="stat-label">Change</div>
                                    <div className={`stat-value ${stockData[ticker].change >= 0 ? 'price-positive' : 'price-negative'}`}>
                                        {stockData[ticker].change >= 0 ? '+' : ''}{stockData[ticker].change} ({stockData[ticker].changePercent}%)
                                    </div>
                                </div>
                                <div className="stat">
                                    <div className="stat-label">Volume</div>
                                    <div className="stat-value">{stockData[ticker].volume}M</div>
                                </div>
                                <div className="stat">
                                    <div className="stat-label">High/Low</div>
                                    <div className="stat-value">${stockData[ticker].high}/${stockData[ticker].low}</div>
                                </div>
                            </div>
                            
                            {analysisResults[ticker] && (
                                <div className="analysis-section">
                                    <div className="analysis-header">
                                        <span>🧠</span>
                                        <span>Rolo's AI Analysis for {ticker}</span>
                                    </div>
                                    <p style={{ marginBottom: '0.75rem', fontSize: '0.875rem' }}>
                                        {analysisResults[ticker].reasoning}
                                    </p>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '1rem' }}>
                                        <div>
                                            <span>Confidence: </span>
                                            <span className="confidence-score">{analysisResults[ticker].confidence}%</span>
                                        </div>
                                        <div style={{ 
                                            fontWeight: 'bold',
                                            color: analysisResults[ticker].recommendation === 'BULLISH' ? '#22c55e' : '#ef4444'
                                        }}>
                                            {analysisResults[ticker].recommendation}
                                        </div>
                                    </div>
                                    <div style={{ marginTop: '0.75rem', fontSize: '0.875rem', color: '#6b7280' }}>
                                        Support: ${analysisResults[ticker].priceTargets.support} | 
                                        Resistance: ${analysisResults[ticker].priceTargets.resistance}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {/* Multiple Watchlists */}
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <h4>📋 Your Watchlists</h4>
                            <button 
                                className="btn btn-small"
                                onClick={() => setShowNewWatchlistInput(!showNewWatchlistInput)}
                            >
                                + New List
                            </button>
                        </div>
                        
                        {showNewWatchlistInput && (
                            <div className="input-group">
                                <input 
                                    className="input"
                                    value={newWatchlistName}
                                    onChange={(e) => setNewWatchlistName(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && createNewWatchlist()}
                                    placeholder="Watchlist name..."
                                />
                                <button className="btn btn-success btn-small" onClick={createNewWatchlist}>
                                    Create
                                </button>
                            </div>
                        )}
                        
                        <div className="watchlist-tabs">
                            {Object.keys(watchlists).map(name => (
                                <div key={name} style={{ display: 'flex', alignItems: 'center' }}>
                                    <div
                                        className={`watchlist-tab ${activeWatchlist === name ? 'active' : ''}`}
                                        onClick={() => setActiveWatchlist(name)}
                                    >
                                        {name} ({watchlists[name].length})
                                    </div>
                                    {Object.keys(watchlists).length > 1 && (
                                        <button 
                                            className="menu-btn"
                                            onClick={() => deleteWatchlist(name)}
                                            title="Delete watchlist"
                                        >
                                            🗑️
                                        </button>
                                    )}
                                </div>
                            ))}
                        </div>
                        
                        <div className="input-group">
                            <input 
                                className="input"
                                value={newTicker}
                                onChange={(e) => setNewTicker(e.target.value.toUpperCase())}
                                onKeyPress={(e) => e.key === 'Enter' && addToWatchlist()}
                                placeholder={`Add ticker to ${activeWatchlist}...`}
                            />
                            <button className="btn btn-small" onClick={addToWatchlist}>Add</button>
                        </div>
                        
                        <div className="watchlist-section">
                            {watchlists[activeWatchlist].map(symbol => (
                                <div 
                                    key={symbol} 
                                    className="watchlist-item"
                                    onClick={() => {
                                        setTicker(symbol);
                                        analyzeStock();
                                    }}
                                >
                                    <div>
                                        <div style={{ fontWeight: 'bold', fontSize: '1rem' }}>{symbol}</div>
                                        <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                            {stockData[symbol] 
                                                ? `$${stockData[symbol].price} (${stockData[symbol].changePercent >= 0 ? '+' : ''}${stockData[symbol].changePercent}%)`
                                                : 'Click to analyze'
                                            }
                                        </div>
                                    </div>
                                    <div className="watchlist-actions">
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.25rem', fontSize: '0.75rem', color: '#6b7280' }}>
                                            <div className="status-dot" style={{ 
                                                width: '6px', 
                                                height: '6px', 
                                                backgroundColor: stockData[symbol]?.isLive ? '#22c55e' : '#eab308' 
                                            }}></div>
                                            <span>{stockData[symbol] ? (stockData[symbol].isLive ? 'Live' : 'Demo') : 'Ready'}</span>
                                        </div>
                                        <button 
                                            className="menu-btn"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                removeFromWatchlist(symbol);
                                            }}
                                        >
                                            ✕
                                        </button>
                                    </div>
                                </div>
                            ))}
                            {watchlists[activeWatchlist].length === 0 && (
                                <div className="empty-state">
                                    <div className="empty-icon">📈</div>
                                    <div>No tickers in this watchlist yet</div>
                                    <div style={{ fontSize: '0.875rem' }}>Add some above to get started!</div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
            
            const renderAnalysis = () => (
                <div>
                    <div className="card">
                        <h3>📊 Technical Analysis Dashboard</h3>
                        {ticker && analysisResults[ticker] ? (
                            <div>
                                <h4 style={{ marginBottom: '1rem' }}>Deep Analysis: {ticker}</h4>
                                
                                <div className="stock-grid">
                                    <div className="stat">
                                        <div className="stat-label">Technical Score</div>
                                        <div className="stat-value" style={{ color: '#7c3aed' }}>
                                            {analysisResults[ticker].technicalScore}/100
                                        </div>
                                    </div>
                                    <div className="stat">
                                        <div className="stat-label">Sentiment Score</div>
                                        <div className="stat-value" style={{ color: '#7c3aed' }}>
                                            {analysisResults[ticker].sentimentScore}/100
                                        </div>
                                    </div>
                                    <div className="stat">
                                        <div className="stat-label">Risk Level</div>
                                        <div className="stat-value" style={{ 
                                            color: analysisResults[ticker].riskLevel === 'Low' ? '#22c55e' : 
                                                   analysisResults[ticker].riskLevel === 'Medium' ? '#eab308' : '#ef4444'
                                        }}>
                                            {analysisResults[ticker].riskLevel}
                                        </div>
                                    </div>
                                    <div className="stat">
                                        <div className="stat-label">AI Confidence</div>
                                        <div className="stat-value" style={{ color: '#22c55e' }}>
                                            {analysisResults[ticker].confidence}%
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="analysis-section">
                                    <div className="analysis-header">
                                        <span>🎯</span>
                                        <span>Key Price Levels</span>
                                    </div>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                        <div>
                                            <strong>Support Level:</strong><br/>
                                            <span style={{ fontSize: '1.25rem', color: '#ef4444' }}>
                                                ${analysisResults[ticker].priceTargets.support}
                                            </span>
                                        </div>
                                        <div>
                                            <strong>Resistance Level:</strong><br/>
                                            <span style={{ fontSize: '1.25rem', color: '#22c55e' }}>
                                                ${analysisResults[ticker].priceTargets.resistance}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="analysis-section">
                                    <div className="analysis-header">
                                        <span>🧠</span>
                                        <span>AI Analysis Summary</span>
                                    </div>
                                    <p>{analysisResults[ticker].reasoning}</p>
                                    <div style={{ marginTop: '0.75rem', padding: '0.75rem', background: 'white', borderRadius: '0.25rem' }}>
                                        <strong>Recommendation: </strong>
                                        <span style={{ 
                                            color: analysisResults[ticker].recommendation === 'BULLISH' ? '#22c55e' : '#ef4444',
                                            fontWeight: 'bold'
                                        }}>
                                            {analysisResults[ticker].recommendation}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="empty-state">
                                <div className="empty-icon">📊</div>
                                <div>No stock analyzed yet</div>
                                <div style={{ fontSize: '0.875rem' }}>
                                    Go to the Ticker tab and analyze a stock to see detailed technical analysis here
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
            
            const renderPlays = () => {
                const plays = getHighConfidencePlays();
                
                return (
                    <div>
                        <div className="card">
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '1rem' }}>
                                <span style={{ fontSize: '1.5rem' }}>🧠</span>
                                <h3>High Confidence Trading Plays</h3>
                            </div>
                            
                            {plays.length > 0 ? (
                                <div>
                                    {plays.map((play, index) => (
                                        <div key={index} className="play-card">
                                            <div className="play-header">
                                                <div>
                                                    <span className="play-symbol">{play.symbol}</span>
                                                    <span className={`play-type ${play.type.toLowerCase()}`}>
                                                        {play.type}
                                                    </span>
                                                    <div style={{ marginTop: '0.25rem' }}>
                                                        <strong>${play.strike} Strike</strong> • {play.dte}DTE
                                                    </div>
                                                    <div className="play-details">
                                                        Current: ${play.currentPrice} ({play.changePercent >= 0 ? '+' : ''}{play.changePercent}%)
                                                    </div>
                                                </div>
                                                <div className="play-confidence">
                                                    {play.confidence}%
                                                </div>
                                            </div>
                                            <p className="play-details" style={{ marginBottom: '0.75rem' }}>
                                                {play.reason}
                                            </p>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                <div style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                                    🧠 Rolo AI • {apiConnected ? 'Live Data' : 'Demo Mode'}
                                                </div>
                                                <button className="btn btn-small">Set Alert</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="empty-state">
                                    <div className="empty-icon">🎯</div>
                                    <div>No High Confidence Plays Yet</div>
                                    <div style={{ fontSize: '0.875rem' }}>
                                        Analyze stocks in the Ticker tab to generate AI-powered trading opportunities
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };
            
            const renderAlerts = () => {
                const alerts = getRecentAlerts();
                
                return (
                    <div>
                        <div className="card">
                            <h3>🔔 Smart Alert System</h3>
                            <p style={{ marginBottom: '1rem', color: '#6b7280' }}>
                                {apiConnected ? 'Live notifications from Alpha Vantage data' : 'Demo notifications - connect APIs for live alerts'}
                            </p>
                            
                            <div style={{ marginBottom: '1.5rem' }}>
                                <h4 style={{ marginBottom: '0.75rem' }}>Alert Settings</h4>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <input type="checkbox" defaultChecked />
                                        <span>High Confidence Plays (80%+)</span>
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <input type="checkbox" defaultChecked />
                                        <span>Unusual Price Movement (3%+)</span>
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <input type="checkbox" defaultChecked />
                                        <span>Watchlist Stock Alerts</span>
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <input type="checkbox" defaultChecked />
                                        <span>Claude AI Analysis Updates</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div className="card">
                            <h4 style={{ marginBottom: '1rem' }}>Recent Alerts</h4>
                            
                            {alerts.map((alert, index) => (
                                <div key={index} className={`alert-item alert-${alert.type}`}>
                                    <div className="alert-title" style={{
                                        color: alert.type === 'success' ? '#166534' : 
                                               alert.type === 'info' ? '#7c3aed' : '#92400e'
                                    }}>
                                        {alert.title}
                                    </div>
                                    <div className="alert-message" style={{
                                        color: alert.type === 'success' ? '#15803d' : 
                                               alert.type === 'info' ? '#6d28d9' : '#a16207'
                                    }}>
                                        {alert.message}
                                    </div>
                                    <div className="alert-time">{alert.time}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };
            
            const tabs = [
                { id: 'chat', icon: '💬', label: 'Chat', component: renderChat },
                { id: 'ticker', icon: '🔍', label: 'Ticker', component: renderTicker },
                { id: 'analysis', icon: '📊', label: 'Analysis', component: renderAnalysis },
                { id: 'plays', icon: '📈', label: 'Plays', component: renderPlays },
                { id: 'alerts', icon: '🔔', label: 'Alerts', component: renderAlerts }
            ];
            
            return (
                <div className="app">
                    <div className="header">
                        <h1>🤖 Rolo AI Trading</h1>
                        <p>Live APIs: Alpha Vantage + Claude AI</p>
                    </div>
                    
                    <div className="status-bar">
                        <div className="status-dot" style={{ backgroundColor: apiConnected ? '#22c55e' : '#eab308' }}></div>
                        <span>
                            {apiConnected 
                                ? '✅ Rolo Online: Live Alpha Vantage Data • Claude AI Chat • Real Analysis' 
                                : '⚠️ Demo Mode: APIs temporarily unavailable'
                            }
                        </span>
                    </div>
                    
                    <div className="content">
                        {tabs.find(tab => tab.id === activeTab)?.component()}
                    </div>
                    
                    <div className="tabs">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                className={`tab ${activeTab === tab.id ? 'active' : ''}`}
                                onClick={() => setActiveTab(tab.id)}
                            >
                                <div className="tab-icon">{tab.icon}</div>
                                <div>{tab.label}</div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('app'));
    </script>
</body>
</html>
